<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <title>FX TAE Trading Dashboard | Professional Trading Journal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- CSS STYLES -->
    <style>
/* Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

:root {
    --primary: #0052CC;
    --primary-dark: #0747A6;
    --secondary: #0065FF;
    --success: #36B37E;
    --danger: #FF5630;
    --warning: #FFAB00;
    --info: #0065FF;
    --dark: #091E42;
    --light: #F4F5F7;
    --gray: #5E6C84;
    --gray-light: #DFE1E6;
    --border-radius: 6px;
    --shadow: 0 2px 8px rgba(9, 30, 66, 0.08);
    --shadow-hover: 0 8px 16px rgba(9, 30, 66, 0.12);
    --transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: #FFFFFF;
    color: var(--dark);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
    touch-action: pan-y;
}

/* Disable zoom */
body {
    -webkit-text-size-adjust: 100%;
    touch-action: manipulation;
}

/* Loading Screen */
.loader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #0065FF 0%, #0747A6 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.loader-content {
    background: white;
    padding: 3rem;
    border-radius: var(--border-radius);
    box-shadow: 0 12px 32px rgba(9, 30, 66, 0.2);
    text-align: center;
    width: 90%;
    max-width: 500px;
}

.loader-content h2 {
    color: var(--primary);
    margin-bottom: 1rem;
    font-size: 2rem;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.loader-content p {
    color: var(--dark);
    margin-bottom: 2rem;
    font-size: 1.1rem;
    font-weight: 500;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: var(--gray-light);
    border-radius: 4px;
    overflow: hidden;
}

.progress {
    height: 100%;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    width: 0%;
    animation: progressLoad 2s ease-in-out forwards;
    border-radius: 4px;
}

@keyframes progressLoad {
    0% { width: 0%; }
    100% { width: 100%; }
}

/* Main Container */
.container {
    display: none;
    opacity: 0;
    transition: var(--transition);
}

.container.show {
    display: block;
    opacity: 1;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Top Navigation */
.top-nav {
    background: white;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 1px 0 var(--gray-light);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    height: 70px;
}

.nav-left {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.menu-btn {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--primary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: var(--border-radius);
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 44px;
    height: 44px;
}

.menu-btn:hover {
    background: var(--light);
}

.menu-btn.active {
    background: var(--primary);
    color: white;
}

.logo {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.logo-icon {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    width: 40px;
    height: 40px;
    border-radius: var(--border-radius);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
}

.logo h1 {
    font-size: 1.5rem;
    font-weight: 700;
    letter-spacing: -0.5px;
}

.logo span {
    color: var(--secondary);
    font-weight: 600;
}

.nav-right {
    display: flex;
    align-items: center;
    gap: 2rem;
}

.date-display {
    background: var(--light);
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    font-weight: 600;
    color: var(--dark);
    font-size: 0.9rem;
    white-space: nowrap;
}

.account-balance-display {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: var(--border-radius);
    color: white;
}

.balance-label {
    font-size: 0.85rem;
    opacity: 0.9;
}

.balance-value {
    font-weight: 700;
    font-size: 1.1rem;
}

/* Sidebar */
.sidebar {
    position: fixed;
    left: 0;
    top: 70px;
    height: calc(100vh - 70px);
    width: 280px;
    background: white;
    box-shadow: 2px 0 8px rgba(9, 30, 66, 0.08);
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1);
    z-index: 99;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--gray-light);
}

.sidebar.show {
    transform: translateX(0);
}

.sidebar.show ~ .main-content {
    margin-left: 280px;
}

.nav-menu {
    list-style: none;
    padding: 2rem 1rem;
    flex: 1;
    overflow-y: auto;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    color: var(--gray);
    text-decoration: none;
    border-radius: var(--border-radius);
    margin-bottom: 0.5rem;
    transition: var(--transition);
    font-weight: 500;
}

.nav-item:hover {
    background: var(--light);
    color: var(--primary);
}

.nav-item.active {
    background: var(--primary);
    color: white;
}

.nav-item i {
    width: 20px;
    text-align: center;
}

.sidebar-footer {
    padding: 1.5rem;
    border-top: 1px solid var(--gray-light);
}

.logout-btn {
    width: 100%;
    padding: 0.8rem;
    background: linear-gradient(135deg, var(--danger), #DE350B);
    color: white;
    border: none;
    border-radius: var(--border-radius);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition);
}

.logout-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

/* Main Content */
.main-content {
    margin-left: 0;
    padding: 2rem;
    transition: var(--transition);
    min-height: calc(100vh - 70px);
    margin-top: 70px;
}

/* Page Styles */
.page {
    display: none;
    animation: fadeIn 0.3s ease;
}

.page.active {
    display: block;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--gray-light);
}

.page-header h2 {
    font-size: 2rem;
    font-weight: 700;
    color: var(--dark);
    letter-spacing: -1px;
}

.export-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: var(--border-radius);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    transition: var(--transition);
}

.export-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

/* Mentorship Banner */
.mentorship-banner {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    padding: 1.5rem;
    border-radius: var(--border-radius);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    box-shadow: var(--shadow);
}

.mentorship-banner h3 {
    color: white;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.2rem;
}

.join-1percent-btn {
    background: white;
    color: var(--primary);
    padding: 0.8rem 2rem;
    border-radius: var(--border-radius);
    text-decoration: none;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: var(--transition);
}

.join-1percent-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

/* Stats Grid */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    transition: var(--transition);
    border-left: 4px solid;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-hover);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    opacity: 0;
    transition: opacity 0.3s ease;
}

.stat-card:hover::before {
    opacity: 1;
}

.todays-pnl-card { 
    border-left-color: #36B37E;
    background: linear-gradient(135deg, rgba(54, 179, 126, 0.05), rgba(54, 179, 126, 0.02));
}

.todays-trades-card { 
    border-left-color: #0065FF;
    background: linear-gradient(135deg, rgba(0, 101, 255, 0.05), rgba(0, 101, 255, 0.02));
}

.weekly-performance-card { 
    border-left-color: #FFAB00;
    background: linear-gradient(135deg, rgba(255, 171, 0, 0.05), rgba(255, 171, 0, 0.02));
}

.monthly-performance-card { 
    border-left-color: #6554C0;
    background: linear-gradient(135deg, rgba(101, 84, 192, 0.05), rgba(101, 84, 192, 0.02));
}

.stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.stat-header h3 {
    font-size: 0.95rem;
    color: var(--gray);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

.stat-actions {
    display: flex;
    gap: 0.5rem;
}

.edit-trades-btn, .download-btn {
    background: none;
    border: none;
    color: var(--gray);
    cursor: pointer;
    padding: 0.3rem;
    border-radius: 4px;
    transition: var(--transition);
}

.edit-trades-btn:hover, .download-btn:hover {
    background: var(--gray-light);
    color: var(--primary);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    font-family: 'SF Mono', 'Roboto Mono', monospace;
    letter-spacing: -1px;
}

.todays-pnl-card .stat-value { color: #36B37E; }
.todays-trades-card .stat-value { color: #0065FF; }
.weekly-performance-card .stat-value { color: #FFAB00; }
.monthly-performance-card .stat-value { color: #6554C0; }

.stat-details {
    font-size: 0.9rem;
    color: var(--gray);
    margin-bottom: 0.5rem;
}

.stat-change {
    font-size: 0.85rem;
    color: var(--gray);
}

.progress-container {
    margin-top: 1rem;
}

.progress-container .progress-bar {
    width: 100%;
    height: 8px;
    background: var(--gray-light);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 0.5rem;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--secondary), var(--primary));
    width: 0%;
    transition: width 0.5s ease;
    border-radius: 4px;
}

/* Balance Manager */
.balance-manager-card, .trade-entry-card, .recent-trades-card {
    background: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 2rem;
    border: 1px solid var(--gray-light);
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--gray-light);
}

.section-header h3 {
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--dark);
}

.balance-form {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 2rem;
}

@media (max-width: 992px) {
    .balance-form {
        grid-template-columns: 1fr;
    }
}

.balance-input-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--dark);
}

.input-with-icon {
    position: relative;
}

.input-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
}

.input-with-icon input {
    padding-left: 2.5rem;
}

.balance-note {
    font-size: 0.85rem;
    color: var(--gray);
    margin-top: 0.5rem;
}

.balance-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.balance-stat {
    background: var(--light);
    padding: 1rem;
    border-radius: var(--border-radius);
    border: 1px solid var(--gray-light);
}

.balance-stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.edit-starting-balance-btn {
    background: none;
    border: none;
    color: var(--gray);
    cursor: pointer;
    padding: 0.3rem;
    border-radius: 4px;
    transition: var(--transition);
}

.edit-starting-balance-btn:hover {
    color: var(--primary);
}

.stat-label {
    font-size: 0.9rem;
    color: var(--gray);
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
}

.edit-buttons {
    margin-top: 0.5rem;
    display: flex;
    gap: 0.5rem;
}

.save-balance-btn, .cancel-balance-btn {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: var(--transition);
}

.save-balance-btn {
    background: var(--success);
    color: white;
}

.cancel-balance-btn {
    background: var(--danger);
    color: white;
}

/* Charts Container */
.charts-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

@media (max-width: 992px) {
    .charts-container {
        grid-template-columns: 1fr;
    }
}

.chart-card {
    background: white;
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-light);
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.chart-header h3 {
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--dark);
}

.chart-period {
    display: flex;
    gap: 0.5rem;
}

.period-btn {
    padding: 0.5rem 1rem;
    border: 1px solid var(--gray-light);
    background: white;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 500;
    transition: var(--transition);
}

.period-btn:hover, .period-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
}

.chart-canvas-container {
    position: relative;
    height: 300px;
    margin-bottom: 1rem;
}

.chart-download-btn {
    text-align: right;
}

/* Trade Entry Form */
.trade-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.form-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-input {
    padding: 0.8rem;
    border: 1px solid var(--gray-light);
    border-radius: var(--border-radius);
    font-size: 1rem;
    transition: var(--transition);
    font-family: 'SF Mono', 'Roboto Mono', monospace;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 82, 204, 0.1);
}

.strategy-input-group {
    display: flex;
    gap: 0.5rem;
}

.strategy-input-group .form-input {
    flex: 1;
}

.form-actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.btn-primary, .btn-secondary, .btn-outline {
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: var(--border-radius);
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-primary {
    background: var(--primary);
    color: white;
}

.btn-primary:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

.btn-secondary {
    background: var(--success);
    color: white;
}

.btn-secondary:hover {
    background: #30A46C;
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

.btn-outline {
    background: white;
    border: 2px solid var(--gray-light);
    color: var(--gray);
}

.btn-outline:hover {
    border-color: var(--primary);
    color: var(--primary);
}

/* Recent Trades Table */
.trades-table {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
}

.trades-table table {
    width: 100%;
    border-collapse: collapse;
    min-width: 800px;
}

.trades-table th {
    background: var(--light);
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--dark);
    border-bottom: 2px solid var(--gray-light);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.trades-table td {
    padding: 1rem;
    border-bottom: 1px solid var(--gray-light);
    font-size: 0.95rem;
}

.trades-table tr:hover {
    background: var(--light);
}

.status-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
    display: inline-block;
    text-align: center;
    min-width: 60px;
}

.status-win {
    background: #E3FCEF;
    color: #36B37E;
}

.status-loss {
    background: #FFEBE6;
    color: #FF5630;
}

.table-actions {
    display: flex;
    gap: 0.5rem;
}

.action-btn {
    background: none;
    border: none;
    color: var(--gray);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 4px;
    transition: var(--transition);
}

.action-btn:hover {
    background: var(--gray-light);
    color: var(--primary);
}

/* Analytics Grid */
.analytics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.analytics-stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    text-align: center;
    border: 1px solid var(--gray-light);
}

.analytics-stat-card:nth-child(1) {
    border-top: 4px solid #6554C0;
    background: linear-gradient(135deg, rgba(101, 84, 192, 0.05), rgba(101, 84, 192, 0.02));
}

.analytics-stat-card:nth-child(2) {
    border-top: 4px solid #00B8D9;
    background: linear-gradient(135deg, rgba(0, 184, 217, 0.05), rgba(0, 184, 217, 0.02));
}

.analytics-stat-card:nth-child(3) {
    border-top: 4px solid #FF5630;
    background: linear-gradient(135deg, rgba(255, 86, 48, 0.05), rgba(255, 86, 48, 0.02));
}

.analytics-stat-card:nth-child(4) {
    border-top: 4px solid #36B37E;
    background: linear-gradient(135deg, rgba(54, 179, 126, 0.05), rgba(54, 179, 126, 0.02));
}

.analytics-stat-card h3 {
    font-size: 0.95rem;
    color: var(--gray);
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.analytics-stat-card .stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    font-family: 'SF Mono', 'Roboto Mono', monospace;
}

.analytics-stat-card:nth-child(1) .stat-value { color: #6554C0; }
.analytics-stat-card:nth-child(2) .stat-value { color: #00B8D9; }
.analytics-stat-card:nth-child(3) .stat-value { color: #FF5630; }
.analytics-stat-card:nth-child(4) .stat-value { color: #36B37E; }

.analytics-stat-card .stat-description {
    font-size: 0.85rem;
    color: var(--gray);
}

/* Calendar */
.calendar-container {
    background: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-light);
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.calendar-header h3 {
    font-size: 1.3rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--dark);
}

.calendar-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.calendar-controls button {
    background: none;
    border: none;
    color: var(--primary);
    cursor: pointer;
    font-size: 1.2rem;
    padding: 0.5rem;
    border-radius: 4px;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
}

.calendar-controls button:hover {
    background: var(--light);
}

.calendar-controls span {
    font-weight: 600;
    color: var(--dark);
    font-size: 1.1rem;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 0.5rem;
}

.calendar-day {
    text-align: center;
    font-weight: 600;
    color: var(--gray);
    padding: 0.5rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.calendar-date {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    border: 1px solid var(--gray-light);
    font-weight: 500;
}

.calendar-date:hover {
    background: var(--light);
}

.calendar-date.profit {
    background: #E3FCEF;
    color: #36B37E;
    border-color: #36B37E;
}

.calendar-date.loss {
    background: #FFEBE6;
    color: #FF5630;
    border-color: #FF5630;
}

.calendar-date.profit::after,
.calendar-date.loss::after {
    content: '';
    position: absolute;
    bottom: 2px;
    left: 50%;
    transform: translateX(-50%);
    width: 4px;
    height: 4px;
    border-radius: 50%;
}

.calendar-date.profit::after {
    background: #36B37E;
}

.calendar-date.loss::after {
    background: #FF5630;
}

/* Notebook */
.notebook-container {
    background: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-light);
}

.dream-input-group {
    margin-bottom: 2rem;
}

.dream-input-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
    color: var(--dark);
}

.dream-input-group textarea {
    width: 100%;
    min-height: 150px;
    padding: 1rem;
    border: 1px solid var(--gray-light);
    border-radius: var(--border-radius);
    font-size: 1rem;
    transition: var(--transition);
    margin-bottom: 1rem;
    resize: vertical;
    font-family: inherit;
}

.dream-input-group textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 82, 204, 0.1);
}

.dreams-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.dream-item {
    background: var(--light);
    padding: 1rem;
    border-radius: var(--border-radius);
    border-left: 4px solid var(--primary);
}

.dream-date {
    font-size: 0.85rem;
    color: var(--gray);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.dream-content {
    color: var(--dark);
    line-height: 1.6;
}

/* Community Grid */
.community-grid, .resources-grid, .motivation-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
}

.community-card, .resource-card, .motivation-card {
    background: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    transition: var(--transition);
    border: 1px solid var(--gray-light);
    position: relative;
    overflow: hidden;
}

.community-card:hover, .resource-card:hover, .motivation-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-hover);
}

.community-icon, .resource-icon, .motivation-icon {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    margin-bottom: 1rem;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
}

.resource-card:nth-child(1) .resource-icon {
    background: linear-gradient(135deg, #6554C0, #5243AA);
}

.resource-card:nth-child(2) .resource-icon {
    background: linear-gradient(135deg, #00B8D9, #008DA6);
}

.resource-card:nth-child(3) .resource-icon {
    background: linear-gradient(135deg, #36B37E, #30A46C);
}

.resource-card:nth-child(4) .resource-icon {
    background: linear-gradient(135deg, #FFAB00, #FF8B00);
}

.community-card h3, .resource-card h3, .motivation-card h4 {
    margin-bottom: 1rem;
    color: var(--dark);
}

.community-card p, .resource-card p, .motivation-card p {
    color: var(--gray);
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.community-btn, .resource-link, .mentorship-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.8rem 1.5rem;
    border-radius: var(--border-radius);
    text-decoration: none;
    font-weight: 600;
    transition: var(--transition);
}

.community-btn {
    background: var(--primary);
    color: white;
}

.community-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
}

.academy-btn {
    background: linear-gradient(135deg, var(--warning), #FF8B00);
    color: white;
}

.resource-links {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.resource-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: var(--light);
    border-radius: var(--border-radius);
    text-decoration: none;
    color: var(--dark);
    transition: var(--transition);
    border: 1px solid var(--gray-light);
}

.resource-link:hover {
    background: white;
    transform: translateX(4px);
    box-shadow: var(--shadow);
}

.resource-link i {
    color: var(--primary);
}

.resource-link strong {
    display: block;
    margin-bottom: 0.2rem;
}

.resource-link span {
    font-size: 0.9rem;
    color: var(--gray);
}

/* Motivation */
.motivation-quote {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    margin-bottom: 2rem;
    text-align: center;
    position: relative;
    color: white;
}

.motivation-quote i.fa-quote-left {
    font-size: 3rem;
    color: rgba(255, 255, 255, 0.2);
    position: absolute;
    top: 1rem;
    left: 1rem;
}

.motivation-quote h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    font-style: italic;
}

.motivation-quote p {
    font-weight: 600;
    opacity: 0.9;
}

/* Settings */
.settings-container {
    background: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-light);
}

.settings-group {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid var(--gray-light);
}

.settings-group h3 {
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--dark);
}

.account-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
}

.account-avatar {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 2rem;
}

.account-details h4 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--dark);
}

.account-details p {
    color: var(--gray);
}

.account-management-form, .trading-rules-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.rule-item {
    display: flex;
    flex-direction: column;
}

.rule-item small {
    font-size: 0.85rem;
    color: var(--gray);
    margin-top: 0.3rem;
}

.theme-toggle {
    display: flex;
    gap: 1rem;
}

.theme-btn {
    flex: 1;
    padding: 1rem;
    border: 2px solid var(--gray-light);
    background: white;
    border-radius: var(--border-radius);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-weight: 600;
    transition: var(--transition);
}

.theme-btn.active {
    border-color: var(--primary);
    background: var(--primary);
    color: white;
}

.theme-btn:hover:not(.active) {
    border-color: var(--primary);
    color: var(--primary);
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
}

.setting-label span {
    display: block;
    font-weight: 600;
    margin-bottom: 0.2rem;
    color: var(--dark);
}

.setting-label small {
    color: var(--gray);
    font-size: 0.85rem;
}

.switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: var(--gray-light);
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: var(--success);
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.export-options {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
}

.export-option {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.export-option input[type="checkbox"] {
    width: 18px;
    height: 18px;
}

/* Contact */
.contact-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
}

@media (max-width: 992px) {
    .contact-container {
        grid-template-columns: 1fr;
    }
}

.contact-info, .mentorship-card {
    background: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-light);
}

.contact-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--gray-light);
}

.contact-item i {
    width: 40px;
    height: 40px;
    background: var(--light);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--primary);
    font-size: 1.2rem;
}

.contact-item h4 {
    margin-bottom: 0.3rem;
    color: var(--dark);
}

.contact-item p {
    color: var(--gray);
}

.social-title {
    margin-top: 2rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.social-links {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.social-link {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    color: var(--dark);
    text-decoration: none;
    padding: 0.8rem;
    border-radius: var(--border-radius);
    transition: var(--transition);
    border: 1px solid var(--gray-light);
}

.social-link:hover {
    background: var(--light);
    color: var(--primary);
}

.social-link i {
    width: 20px;
    text-align: center;
}

.mentorship-card {
    position: relative;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;
}

.mentorship-badge {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 0.5rem 1.5rem;
    border-radius: 20px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--primary);
}

.mentorship-card h3 {
    margin-top: 1rem;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.mentorship-card p {
    margin-bottom: 2rem;
    line-height: 1.6;
    opacity: 0.9;
}

.mentorship-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    background: white;
    color: var(--primary);
    text-decoration: none;
    border-radius: var(--border-radius);
    font-weight: 700;
    transition: var(--transition);
}

.mentorship-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(255, 255, 255, 0.2);
}

/* Modals */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(9, 30, 66, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    display: none;
    padding: 1rem;
}

.modal.show {
    display: flex;
}

.modal-content {
    background: white;
    width: 100%;
    max-width: 500px;
    border-radius: var(--border-radius);
    box-shadow: 0 20px 32px rgba(9, 30, 66, 0.2);
    animation: modalSlide 0.3s ease;
    max-height: 90vh;
    overflow-y: auto;
}

@keyframes modalSlide {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid var(--gray-light);
    position: sticky;
    top: 0;
    background: white;
    z-index: 1;
}

.modal-header h3 {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--gray);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 4px;
}

.close-modal:hover {
    background: var(--light);
    color: var(--danger);
}

.modal-body {
    padding: 1.5rem;
}

.modal-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 1.5rem;
}

/* Toast Notifications */
.toast-container {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 3000;
}

.toast {
    background: white;
    padding: 1rem 1.5rem;
    border-radius: var(--border-radius);
    box-shadow: 0 8px 16px rgba(9, 30, 66, 0.15);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    animation: toastSlide 0.3s ease;
    min-width: 300px;
    max-width: 400px;
    border-left: 4px solid;
}

@keyframes toastSlide {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.toast.success {
    border-left-color: var(--success);
}

.toast.error {
    border-left-color: var(--danger);
}

.toast.info {
    border-left-color: var(--info);
}

.toast.warning {
    border-left-color: var(--warning);
}

.toast-icon {
    font-size: 1.5rem;
}

.toast.success .toast-icon { color: var(--success); }
.toast.error .toast-icon { color: var(--danger); }
.toast.info .toast-icon { color: var(--info); }
.toast.warning .toast-icon { color: var(--warning); }

.toast-content h4 {
    font-size: 1rem;
    margin-bottom: 0.2rem;
    font-weight: 600;
}

.toast-content p {
    font-size: 0.9rem;
    color: var(--gray);
}

.toast-close {
    margin-left: auto;
    background: none;
    border: none;
    color: var(--gray);
    cursor: pointer;
    padding: 0.3rem;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
}

.toast-close:hover {
    background: var(--light);
    color: var(--danger);
}

/* Dark Theme */
body.dark-theme {
    background: #1D2125;
    color: #C1C7D0;
}

body.dark-theme .top-nav {
    background: #22272B;
    box-shadow: 0 1px 0 #2C333A;
}

body.dark-theme .sidebar {
    background: #22272B;
    border-right-color: #2C333A;
}

body.dark-theme .stat-card,
body.dark-theme .chart-card,
body.dark-theme .balance-manager-card,
body.dark-theme .trade-entry-card,
body.dark-theme .recent-trades-card,
body.dark-theme .notebook-container,
body.dark-theme .settings-container,
body.dark-theme .contact-info,
body.dark-theme .calendar-container {
    background: #22272B;
    border-color: #2C333A;
    color: #C1C7D0;
}

body.dark-theme .form-input,
body.dark-theme select.form-input,
body.dark-theme textarea {
    background: #1D2125;
    border-color: #2C333A;
    color: #C1C7D0;
}

body.dark-theme .trades-table th {
    background: #1D2125;
    color: #8C9BAB;
    border-bottom-color: #2C333A;
}

body.dark-theme .trades-table td {
    border-bottom-color: #2C333A;
}

body.dark-theme .trades-table tr:hover {
    background: #2C333A;
}

body.dark-theme .balance-stat {
    background: #1D2125;
    border-color: #2C333A;
}

/* Responsive Design */
@media (max-width: 768px) {
    .top-nav {
        padding: 1rem;
    }
    
    .nav-right {
        gap: 1rem;
    }
    
    .date-display {
        display: none;
    }
    
    .main-content {
        padding: 1rem;
        margin-top: 70px;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .charts-container {
        grid-template-columns: 1fr;
    }
    
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
    
    .btn-primary, .btn-secondary, .btn-outline {
        width: 100%;
        justify-content: center;
    }
    
    .balance-stats {
        grid-template-columns: 1fr;
    }
    
    .trades-table {
        font-size: 0.9rem;
    }
    
    .community-grid, .resources-grid, .motivation-grid {
        grid-template-columns: 1fr;
    }
    
    .calendar-grid {
        grid-template-columns: repeat(7, 1fr);
        font-size: 0.9rem;
    }
    
    .toast {
        min-width: 250px;
        max-width: 300px;
    }
    
    .sidebar.show ~ .main-content {
        margin-left: 0;
    }
    
    .sidebar {
        width: 100%;
        z-index: 999;
    }
}

/* Print Styles */
@media print {
    .top-nav, .sidebar, .mentorship-banner,
    .form-actions, .chart-download-btn, .export-btn,
    .modal, .toast-container,
    .table-actions {
        display: none !important;
    }
    
    .main-content {
        margin-left: 0 !important;
        padding: 0 !important;
        margin-top: 0 !important;
    }
    
    .page {
        display: block !important;
    }
    
    body {
        background: white !important;
        color: black !important;
    }
    
    .stat-card, .chart-card, .balance-manager-card,
    .trade-entry-card, .recent-trades-card {
        break-inside: avoid;
        box-shadow: none !important;
        border: 1px solid #ddd !important;
        margin: 10px 0 !important;
    }
    
    .trades-table table {
        border: 1px solid #000 !important;
    }
    
    .trades-table th, .trades-table td {
        border: 1px solid #000 !important;
        padding: 8px !important;
    }
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: var(--light);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: var(--gray);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: var(--dark);
}
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loader" id="loader">
        <div class="loader-content">
            <h2>FX TAE 1% TRADING CIRCLE</h2>
            <p>Loading Professional Trading Dashboard...</p>
            <div class="progress-bar">
                <div class="progress"></div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContainer">
        <!-- Top Navigation -->
        <nav class="top-nav">
            <div class="nav-left">
                <button class="menu-btn" id="menuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <h1>FX TAE <span>1% CIRCLE</span></h1>
                </div>
            </div>
            
            <div class="nav-right">
                <div class="date-display" id="currentDate"></div>
                <div class="account-balance-display">
                    <span class="balance-label">Balance:</span>
                    <span class="balance-value" id="accountBalance">$0.00</span>
                </div>
            </div>
        </nav>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <ul class="nav-menu">
                <li><a href="#" class="nav-item active" data-page="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="#" class="nav-item" data-page="journal"><i class="fas fa-book"></i> Trade Journal</a></li>
                <li><a href="#" class="nav-item" data-page="analytics"><i class="fas fa-chart-bar"></i> Analytics</a></li>
                <li><a href="#" class="nav-item" data-page="notebook"><i class="fas fa-book"></i> Notebook</a></li>
                <li><a href="#" class="nav-item" data-page="community"><i class="fas fa-users"></i> Community</a></li>
                <li><a href="#" class="nav-item" data-page="resources"><i class="fas fa-link"></i> Resources</a></li>
                <li><a href="#" class="nav-item" data-page="motivation"><i class="fas fa-fire"></i> Trader's Mindset</a></li>
                <li><a href="#" class="nav-item" data-page="settings"><i class="fas fa-cog"></i> Settings</a></li>
                <li><a href="#" class="nav-item" data-page="contact"><i class="fas fa-envelope"></i> Contact</a></li>
            </ul>
            
            <div class="sidebar-footer">
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Dashboard Page -->
            <section class="page active" id="dashboard">
                <!-- Mentorship Banner -->
                <div class="mentorship-banner">
                    <h3><i class="fas fa-crown"></i> JOIN THE 1% TRADING CIRCLE</h3>
                    <a href="https://fxtaetrader.page.gd/" class="join-1percent-btn" target="_blank">
                        <i class="fas fa-rocket"></i> JOIN NOW
                    </a>
                </div>

                <div class="page-header">
                    <h2>Professional Trading Dashboard</h2>
                </div>

                <!-- Performance Stats -->
                <div class="stats-grid">
                    <div class="stat-card todays-pnl-card">
                        <div class="stat-header">
                            <h3><i class="fas fa-calendar-day"></i> Today's P&L</h3>
                            <div class="stat-actions">
                                <button class="edit-trades-btn" onclick="editTodayTrades()">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="download-btn" onclick="downloadTodayStats()">
                                    <i class="fas fa-download"></i>
                                </button>
                            </div>
                        </div>
                        <div class="stat-value" id="todayPnl">$0.00</div>
                        <div class="stat-details" id="todayTradesList">No trades today</div>
                        <div class="stat-change" id="todayChange">Start trading to see performance</div>
                    </div>

                    <div class="stat-card todays-trades-card">
                        <div class="stat-header">
                            <h3><i class="fas fa-exchange-alt"></i> Today's Trades</h3>
                            <div class="stat-actions">
                                <button class="edit-trades-btn" onclick="editTodayTrades()">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                        <div class="stat-value" id="todayTradesCount">0/4</div>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 0%"></div>
                            </div>
                            <span>0% Daily Limit</span>
                        </div>
                    </div>

                    <div class="stat-card weekly-performance-card">
                        <div class="stat-header">
                            <h3><i class="fas fa-calendar-week"></i> Weekly Performance</h3>
                        </div>
                        <div class="stat-value" id="weeklyPnl">$0.00</div>
                        <div class="stat-details" id="weeklyTradesList">No weekly trades</div>
                        <div class="stat-change" id="weeklyChange">Weekly performance will appear here</div>
                    </div>

                    <div class="stat-card monthly-performance-card">
                        <div class="stat-header">
                            <h3><i class="fas fa-calendar-alt"></i> Monthly Performance</h3>
                        </div>
                       <div class="stat-value" id="monthlyPnl">$0.00</div>
                        <div class="stat-details" id="monthlyTradesList">No monthly trades</div>
                        <div class="stat-change" id="monthlyChange">Monthly performance will appear here</div>
                    </div>
                </div>

                <!-- Account Balance Manager -->
                <div class="balance-manager-card">
                    <div class="section-header">
                        <h3><i class="fas fa-wallet"></i> Account Balance Manager</h3>
                    </div>
                    
                    <div class="balance-form">
                        <div class="balance-input-group">
                            <label><i class="fas fa-dollar-sign"></i> Current Balance ($)</label>
                            <div class="input-with-icon">
                                <span class="input-icon">$</span>
                                <input type="number" id="currentBalanceInput" class="form-input" value="0.00" readonly>
                            </div>
                            <p class="balance-note">Auto-updated from trades</p>
                        </div>
                        
                        <div class="balance-stats">
                            <div class="balance-stat">
                                <div class="balance-stat-header">
                                    <span class="stat-label">Starting Balance</span>
                                    <button class="edit-starting-balance-btn" onclick="editStartingBalance()" title="Edit Starting Balance">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                                <div class="balance-stat-content">
                                    <span class="stat-value" id="startingBalance">$0.00</span>
                                    <input type="number" id="startingBalanceInput" class="edit-input" style="display: none;" placeholder="Enter new starting balance" step="0.01" min="0">
                                </div>
                                <div class="edit-buttons">
                                    <button id="saveBalanceBtn" class="save-balance-btn" onclick="saveStartingBalance()" style="display: none;">
                                        <i class="fas fa-check"></i> Save
                                    </button>
                                    <button id="cancelBalanceBtn" class="cancel-balance-btn" onclick="cancelStartingBalanceEdit()" style="display: none;">
                                        <i class="fas fa-times"></i> Cancel
                                    </button>
                                </div>
                            </div>
                            <div class="balance-stat">
                                <span class="stat-label">Total Growth</span>
                                <span class="stat-value" id="totalGrowth">$0.00</span>
                            </div>
                            <div class="balance-stat">
                                <span class="stat-label">Growth %</span>
                                <span class="stat-value" id="growthPercentage">0%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-line"></i> Equity Curve</h3>
                            <div class="chart-period">
                                <button class="period-btn active" data-period="1m" onclick="updateChartPeriod('1m')">1M</button>
                                <button class="period-btn" data-period="12m" onclick="updateChartPeriod('12m')">12M</button>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="equityChart"></canvas>
                        </div>
                        <div class="chart-download-btn">
                            <button class="btn-secondary" onclick="downloadChart('equityChart', 'Equity_Curve')">
                                <i class="fas fa-download"></i> Download Chart
                            </button>
                        </div>
                    </div>

                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-pie"></i> Win Rate Analysis</h3>
                            <div class="win-rate">
                                <span class="rate-value" id="winRateValue">0%</span>
                                <span class="rate-label">Win Rate</span>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="winRateChart"></canvas>
                        </div>
                        <div class="chart-download-btn">
                            <button class="btn-secondary" onclick="downloadChart('winRateChart', 'Win_Rate_Analysis')">
                                <i class="fas fa-download"></i> Download Chart
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Trade Entry -->
                <div class="trade-entry-card">
                    <div class="section-header">
                        <h3><i class="fas fa-bolt"></i> Quick Trade Entry</h3>
                        <button class="btn-secondary" onclick="saveAndDownloadTrade()">
                            <i class="fas fa-save"></i> Save & Download
                        </button>
                    </div>
                    
                    <form class="trade-form" id="tradeForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="far fa-calendar"></i> Date</label>
                                <input type="date" id="tradeDate" class="form-input" required>
                            </div>
                            <div class="form-group">
                                <label><i class="far fa-clock"></i> Time</label>
                                <input type="time" id="tradeTime" class="form-input" value="09:30" required>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-hashtag"></i> Trade # (1-4)</label>
                                <select id="tradeNumber" class="form-input" required>
                                    <option value="1">Trade 1</option>
                                    <option value="2">Trade 2</option>
                                    <option value="3">Trade 3</option>
                                    <option value="4">Trade 4</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fas fa-chess-knight"></i> Strategy</label>
                                <div class="strategy-input-group">
                                    <select id="strategy" class="form-input" required>
                                        <option value="Breakout">Breakout Trading</option>
                                        <option value="Trend">Trend Following</option>
                                        <option value="Scalping">Scalping</option>
                                        <option value="Swing">Swing Trading</option>
                                        <option value="Price Action">Price Action</option>
                                        <option value="News Trading">News Trading</option>
                                        <option value="Supply Demand">Supply & Demand</option>
                                    </select>
                                    <button type="button" class="btn-secondary" onclick="showCustomStrategy()">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <input type="text" id="customStrategy" class="form-input" style="display: none; margin-top: 0.5rem;" placeholder="Enter custom strategy name">
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-globe"></i> Currency Pair / Instrument</label>
                                <select id="currencyPair" class="form-input" required>
                                    <optgroup label="Major Forex">
                                        <option value="EUR/USD">EUR/USD</option>
                                        <option value="GBP/USD">GBP/USD</option>
                                        <option value="USD/JPY">USD/JPY</option>
                                        <option value="AUD/USD">AUD/USD</option>
                                        <option value="USD/CAD">USD/CAD</option>
                                        <option value="NZD/USD">NZD/USD</option>
                                        <option value="USD/CHF">USD/CHF</option>
                                        <option value="EUR/GBP">EUR/GBP</option>
                                        <option value="EUR/JPY">EUR/JPY</option>
                                        <option value="GBP/JPY">GBP/JPY</option>
                                    </optgroup>
                                    <optgroup label="Minor Forex">
                                        <option value="EUR/AUD">EUR/AUD</option>
                                        <option value="EUR/CAD">EUR/CAD</option>
                                        <option value="EUR/NZD">EUR/NZD</option>
                                        <option value="GBP/AUD">GBP/AUD</option>
                                        <option value="GBP/CAD">GBP/CAD</option>
                                        <option value="AUD/JPY">AUD/JPY</option>
                                        <option value="CAD/JPY">CAD/JPY</option>
                                        <option value="NZD/JPY">NZD/JPY</option>
                                        <option value="AUD/NZD">AUD/NZD</option>
                                        <option value="AUD/CAD">AUD/CAD</option>
                                    </optgroup>
                                    <optgroup label="Metals">
                                        <option value="XAU/USD">XAU/USD (Gold)</option>
                                        <option value="XAG/USD">XAG/USD (Silver)</option>
                                    </optgroup>
                                    <optgroup label="Indices">
                                        <option value="US30">US30 (Dow Jones)</option>
                                        <option value="NAS100">NAS100 (Nasdaq)</option>
                                        <option value="SPX500">SPX500 (S&P 500)</option>
                                    </optgroup>
                                    <optgroup label="Crypto">
                                        <option value="BTC/USD">BTC/USD (Bitcoin)</option>
                                        <option value="ETH/USD">ETH/USD (Ethereum)</option>
                                    </optgroup>
                                    <optgroup label="Commodities">
                                        <option value="USOIL">USOIL (Crude Oil)</option>
                                        <option value="UKOIL">UKOIL (Brent Oil)</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-coins"></i> P&L ($)</label>
                                <div class="input-with-icon">
                                    <span class="input-icon">$</span>
                                    <input type="number" step="0.01" id="pnlAmount" class="form-input" placeholder="Enter amount" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fas fa-sticky-note"></i> Notes</label>
                                <input type="text" id="tradeNotes" class="form-input" placeholder="Trade setup, emotions, lessons...">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn-primary" onclick="saveTrade()">
                                <i class="fas fa-save"></i> Save Trade
                            </button>
                            <button type="button" class="btn-secondary" onclick="saveAndDownloadTrade()">
                                <i class="fas fa-download"></i> Save & Download PDF
                            </button>
                            <button type="reset" class="btn-outline" onclick="resetTradeForm()">
                                <i class="fas fa-redo"></i> Clear Form
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Recent Trades -->
                <div class="recent-trades-card">
                    <div class="section-header">
                        <h3><i class="fas fa-history"></i> Recent Trades</h3>
                        <button class="edit-trades-btn" onclick="editTodayTrades()">
                            <i class="fas fa-edit"></i> Edit Today's Trades
                        </button>
                    </div>
                    <div class="trades-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Date & Time</th>
                                    <th>Trade #</th>
                                    <th>Pair</th>
                                    <th>Strategy</th>
                                    <th>P&L</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentTradesTable">
                                <!-- Will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Journal Page -->
            <section class="page" id="journal">
                <div class="page-header">
                    <h2>Trade Journal</h2>
                    <button class="export-btn" onclick="exportJournalPDF()">
                        <i class="fas fa-file-pdf"></i> Export Journal PDF
                    </button>
                </div>
                <div class="trades-table full-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Trade #</th>
                                <th>Pair</th>
                                <th>Strategy</th>
                                <th>P&L</th>
                                <th>Notes</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="allTradesTable">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Analytics Page -->
            <section class="page" id="analytics">
                <div class="page-header">
                    <h2>Advanced Analytics</h2>
                    <button class="export-btn" onclick="exportAnalyticsPDF()">
                        <i class="fas fa-chart-bar"></i> Export Analytics PDF
                    </button>
                </div>
                
                <!-- Key Metrics -->
                <div class="analytics-grid">
                    <div class="analytics-stat-card">
                        <h3>Profit Factor</h3>
                        <div class="stat-value" id="profitFactorValue">0.0</div>
                        <div class="stat-description">Gross Profit / Gross Loss</div>
                    </div>
                    
                    <div class="analytics-stat-card">
                        <h3>Win Rate</h3>
                        <div class="stat-value" id="analyticsWinRate">0%</div>
                        <div class="stat-description">Winning Trades Percentage</div>
                    </div>
                    
                    <div class="analytics-stat-card">
                        <h3>Risk/Reward</h3>
                        <div class="stat-value" id="riskRewardRatio">0.0</div>
                        <div class="stat-description">Average Win / Average Loss</div>
                    </div>
                    
                    <div class="analytics-stat-card">
                        <h3>Total Trades</h3>
                        <div class="stat-value" id="totalTradesCount">0</div>
                        <div class="stat-description">All Trades Recorded</div>
                    </div>
                </div>
                
                <!-- Charts Grid -->
                <div class="analytics-grid">
                    <!-- Average Win vs Average Loss -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-balance-scale-left"></i> Average Win vs Loss</h3>
                            <div class="win-rate">
                                <span class="rate-value" id="avgWinLossRatio">0.0</span>
                                <span class="rate-label">Win/Loss Ratio</span>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="avgWinLossChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Profits Distribution -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-chart-pie"></i> Profit Distribution</h3>
                            <div class="win-rate">
                                <span class="rate-value" id="totalProfitValue">$0</span>
                                <span class="rate-label">Total Profit</span>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="profitDistributionChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Long vs Short Trades -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-exchange-alt"></i> Long vs Short Trades</h3>
                            <div class="win-rate">
                                <span class="rate-value" id="longShortRatio">0:0</span>
                                <span class="rate-label">Long:Short</span>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="longShortChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Winning vs Losing -->
                    <div class="chart-card">
                        <div class="chart-header">
                            <h3><i class="fas fa-trophy"></i> Winning vs Losing</h3>
                            <div class="win-rate">
                                <span class="rate-value" id="winLossRatio">0%</span>
                                <span class="rate-label">Win Rate</span>
                            </div>
                        </div>
                        <div class="chart-canvas-container">
                            <canvas id="winLossChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Daily P&L Calendar -->
                <div class="calendar-container">
                    <div class="calendar-header">
                        <h3><i class="fas fa-calendar-alt"></i> Daily P&L Calendar</h3>
                    </div>
                    <div class="calendar-controls">
                        <button onclick="changeCalendarMonth(-1)"><i class="fas fa-chevron-left"></i></button>
                        <span id="calendarMonth">January 2024</span>
                        <button onclick="changeCalendarMonth(1)"><i class="fas fa-chevron-right"></i></button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Notebook Page -->
            <section class="page" id="notebook">
                <div class="page-header">
                    <h2>Notebook</h2>
                </div>
                
                <div class="notebook-container">
                    <div class="dream-input-group">
                        <label><i class="fas fa-pen"></i> Write Your Trading Notes</label>
                        <textarea id="dreamInput" placeholder="Write your trading thoughts, observations, and lessons learned here..."></textarea>
                        <div class="form-actions">
                            <button class="btn-primary" onclick="saveDream()">
                                <i class="fas fa-save"></i> Save Note
                            </button>
                            <button class="btn-secondary" onclick="clearDream()">
                                <i class="fas fa-redo"></i> Clear
                            </button>
                        </div>
                    </div>
                    
                    <div class="dreams-list" id="dreamsList">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Community Page -->
            <section class="page" id="community">
                <div class="page-header">
                    <h2>Join Our Community</h2>
                </div>
                
                <div class="community-grid">
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-telegram"></i>
                        </div>
                        <h3>Telegram Group</h3>
                        <p>Join our active Telegram community for daily market analysis, trade ideas, and discussions with fellow traders.</p>
                        <a href="https://t.me/fxtaetrader" class="community-btn" target="_blank">
                            <i class="fab fa-telegram"></i> Join Telegram
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-youtube"></i>
                        </div>
                        <h3>YouTube Channel</h3>
                        <p>Subscribe to our YouTube channel for educational content, live trading sessions, and market insights.</p>
                        <a href="https://www.youtube.com/@fxtaetrader" class="community-btn" target="_blank">
                            <i class="fab fa-youtube"></i> Subscribe
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-instagram"></i>
                        </div>
                        <h3>Instagram</h3>
                        <p>Follow us on Instagram for trading psychology tips, daily motivation, and behind-the-scenes content.</p>
                        <a href="https://instagram.com/fxtaetrader" class="community-btn" target="_blank">
                            <i class="fab fa-instagram"></i> Follow
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-tiktok"></i>
                        </div>
                        <h3>TikTok</h3>
                        <p>Watch short, engaging trading tips and market analysis on our TikTok channel.</p>
                        <a href="https://tiktok.com/@fx_tae_trader" class="community-btn" target="_blank">
                            <i class="fab fa-tiktok"></i> Follow
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fab fa-facebook"></i>
                        </div>
                        <h3>Facebook</h3>
                        <p>Connect with us on Facebook for community events, live Q&A sessions, and trading resources.</p>
                        <a href="https://facebook.com/fxtaetrader" class="community-btn" target="_blank">
                            <i class="fab fa-facebook"></i> Like Page
                        </a>
                    </div>
                    
                    <div class="community-card">
                        <div class="community-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <h3>Exclusive Academy</h3>
                        <p>Join our premium trading academy for personalized coaching, advanced strategies, and mentorship.</p>
                        <a href="https://fxtaetrader.page.gd/" class="community-btn academy-btn" target="_blank">
                            <i class="fas fa-rocket"></i> Join Academy
                        </a>
                    </div>
                </div>
            </section>

            <!-- Resources Page -->
            <section class="page" id="resources">
                <div class="page-header">
                    <h2>Trading Resources</h2>
                </div>
                
                <div class="resources-grid">
                    <!-- Brokers -->
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-university"></i>
                        </div>
                        <h3>Trusted Brokers</h3>
                        <div class="resource-links">
                            <a href="https://one.exnessonelink.com/a/f8t7u25p4e?source=app" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>Exness</strong>
                                    <span>Low spreads, fast execution</span>
                                </div>
                            </a>
                            <a href="https://www.xmglobal.com/referral?token=UwkIjT3bocE_ES4g8nXlsA" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>XM Broker</strong>
                                    <span>1000+ instruments</span>
                                </div>
                            </a>
                            <a href="https://www.fbs.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>FBS Broker</strong>
                                    <span>Popular broker worldwide</span>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Prop Firms -->
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-building"></i>
                        </div>
                        <h3>Prop Trading Firms</h3>
                        <div class="resource-links">
                            <a href="https://www.fundednext.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>Funded Next</strong>
                                    <span>High payouts, great scaling</span>
                                </div>
                            </a>
                            <a href="https://www.fundingpips.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>Funding Pips</strong>
                                    <span>Flexible rules, instant funding</span>
                                </div>
                            </a>
                            <a href="https://www.ftmo.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>FTMO</strong>
                                    <span>Industry leader, 90% profit split</span>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Analysis Tools -->
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>Analysis Tools</h3>
                        <div class="resource-links">
                            <a href="https://www.forexfactory.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>Forex Factory</strong>
                                    <span>Economic calendar & news</span>
                                </div>
                            </a>
                            <a href="https://www.babypips.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>BabyPips</strong>
                                    <span>Education & market sentiment</span>
                                </div>
                            </a>
                            <a href="https://www.tradingview.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>TradingView</strong>
                                    <span>Advanced charts & community</span>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Trading Platforms -->
                    <div class="resource-card">
                        <div class="resource-icon">
                            <i class="fas fa-desktop"></i>
                        </div>
                        <h3>Trading Platforms</h3>
                        <div class="resource-links">
                            <a href="https://www.metatrader4.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>MetaTrader 4</strong>
                                    <span>Most popular trading platform</span>
                                </div>
                            </a>
                            <a href="https://www.metatrader5.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>MetaTrader 5</strong>
                                    <span>Advanced features</span>
                                </div>
                            </a>
                            <a href="https://www.tradingview.com" target="_blank" class="resource-link">
                                <i class="fas fa-external-link-alt"></i>
                                <div>
                                    <strong>TradingView</strong>
                                    <span>Web-based charts & analysis</span>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Motivation Page -->
            <section class="page" id="motivation">
                <div class="page-header">
                    <h2>Trader's Mindset</h2>
                </div>
                
                <div class="motivation-quote">
                    <i class="fas fa-quote-left"></i>
                    <h3>"The goal of a successful trader is to make the best trades. Money is secondary."</h3>
                    <p>- Alexander Elder</p>
                </div>
                
                <div class="motivation-grid">
                    <div class="motivation-card">
                        <div class="motivation-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <h4>1. Discipline</h4>
                        <p>Stick to your trading plan regardless of emotions. Every trade must follow your rules.</p>
                    </div>
                    
                    <div class="motivation-card">
                        <div class="motivation-icon">
                            <i class="fas fa-hourglass-half"></i>
                        </div>
                        <h4>2. Patience</h4>
                        <p>Wait for the right setups. The market will always provide opportunities.</p>
                    </div>
                    
                    <div class="motivation-card">
                        <div class="motivation-icon">
                            <i class="fas fa-brain"></i>
                        </div>
                        <h4>3. Psychology</h4>
                        <p>Master your emotions. Fear and greed are your biggest enemies.</p>
                    </div>
                    
                    <div class="motivation-card">
                        <div class="motivation-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <h4>4. Journaling</h4>
                        <p>Record every trade. Review regularly. Learn from both wins and losses.</p>
                    </div>
                </div>
            </section>

            <!-- Settings Page -->
            <section class="page" id="settings">
                <div class="page-header">
                    <h2>Settings</h2>
                </div>
                
                <div class="settings-container">
                    <!-- Trading Rules -->
                    <div class="settings-group">
                        <h3><i class="fas fa-ruler-combined"></i> Trading Rules</h3>
                        
                        <div class="trading-rules-form">
                            <div class="rule-item">
                                <label><i class="fas fa-ban"></i> Daily Max Loss (%)</label>
                                <input type="number" id="dailyMaxLoss" class="form-input" placeholder="e.g., 2" step="0.1" min="0" max="100" value="2">
                                <small>Maximum daily loss percentage</small>
                            </div>
                            
                            <div class="rule-item">
                                <label><i class="fas fa-exchange-alt"></i> Daily Trade Limit</label>
                                <input type="number" id="dailyTradeLimit" class="form-input" placeholder="e.g., 4" min="1" max="20" value="4">
                                <small>Maximum trades per day</small>
                            </div>
                            
                            <div class="rule-item">
                                <label><i class="fas fa-shield-alt"></i> Risk Per Trade (%)</label>
                                <input type="number" id="riskPerTrade" class="form-input" placeholder="e.g., 1" step="0.1" min="0" max="100" value="1">
                                <small>Risk percentage per trade</small>
                            </div>
                            
                            <div class="rule-item">
                                <label><i class="fas fa-clock"></i> Trading Hours</label>
                                <select id="tradingHours" class="form-input">
                                    <option value="24/7">24/7 (All Hours)</option>
                                    <option value="london">London Session</option>
                                    <option value="newyork">New York Session</option>
                                    <option value="asia">Asia Session</option>
                                    <option value="custom">Custom Hours</option>
                                </select>
                                <small>Trading session preference</small>
                            </div>
                        </div>
                        
                        <div class="form-actions" style="margin-top: 1rem;">
                            <button class="btn-primary" onclick="saveTradingRules()">
                                <i class="fas fa-save"></i> Save Trading Rules
                            </button>
                        </div>
                    </div>
                    
                    <!-- Theme Settings -->
                    <div class="settings-group">
                        <h3><i class="fas fa-palette"></i> Theme Settings</h3>
                        
                        <div class="theme-toggle">
                            <button class="theme-btn active" onclick="setTheme('light')" id="lightThemeBtn">
                                <i class="fas fa-sun"></i> Light Theme
                            </button>
                            <button class="theme-btn" onclick="setTheme('dark')" id="darkThemeBtn">
                                <i class="fas fa-moon"></i> Dark Theme
                            </button>
                        </div>
                    </div>
                    
                    <!-- Notifications -->
                    <div class="settings-group">
                        <h3><i class="fas fa-bell"></i> Notifications</h3>
                        
                        <div class="setting-item">
                            <div class="setting-label">
                                <span>Trade Reminders</span>
                                <small>Get reminders for trade entries</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="tradeReminders" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-label">
                                <span>Daily Summary</span>
                                <small>Receive daily performance summary</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="dailySummary" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-label">
                                <span>Loss Limit Alerts</span>
                                <small>Alert when approaching daily loss limit</small>
                            </div>
                            <label class="switch">
                                <input type="checkbox" id="lossAlerts" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Data Export -->
                    <div class="settings-group">
                        <h3><i class="fas fa-file-export"></i> Data Export</h3>
                        
                        <div class="export-options">
                            <div class="export-option">
                                <input type="checkbox" id="exportCharts" checked>
                                <label for="exportCharts">Include Charts</label>
                            </div>
                            
                            <div class="export-option">
                                <input type="checkbox" id="exportStatistics" checked>
                                <label for="exportStatistics">Include Statistics</label>
                            </div>
                            
                            <div class="export-option">
                                <input type="checkbox" id="exportNotes" checked>
                                <label for="exportNotes">Include Notes</label>
                            </div>
                            
                            <div class="export-option">
                                <input type="checkbox" id="exportDreams" checked>
                                <label for="exportDreams">Include Notebook</label>
                            </div>
                            
                            <div class="export-option">
                                <input type="checkbox" id="exportSettings" checked>
                                <label for="exportSettings">Include Settings</label>
                            </div>
                            
                            <div class="export-option">
                                <input type="checkbox" id="exportTradingRules" checked>
                                <label for="exportTradingRules">Include Trading Rules</label>
                            </div>
                        </div>
                        
                        <div class="setting-item" style="margin-top: 1rem;">
                            <div class="setting-label">
                                <span>Export Format</span>
                                <small>Choose export file format</small>
                            </div>
                            <select id="exportFormat" class="form-input" style="width: 150px;">
                                <option value="pdf">PDF Document</option>
                                <option value="json">JSON Data</option>
                                <option value="csv">CSV Spreadsheet</option>
                            </select>
                        </div>
                        
                        <div class="form-actions" style="margin-top: 1.5rem;">
                            <button class="btn-primary" onclick="exportAllData()">
                                <i class="fas fa-download"></i> Export All Data
                            </button>
                            <button class="btn-secondary" onclick="backupData()">
                                <i class="fas fa-save"></i> Backup Data
                            </button>
                            <button class="btn-outline" onclick="clearAllData()">
                                <i class="fas fa-trash"></i> Clear All Data
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Contact Page -->
            <section class="page" id="contact">
                <div class="page-header">
                    <h2>Contact FX Tae</h2>
                </div>
                
                <div class="contact-container">
                    <div class="contact-info">
                        <h3><i class="fas fa-info-circle"></i> Contact Information</h3>
                        
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <h4>Email</h4>
                                <p>fxtae.chartprogram@gmail.com</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <h4>Phone</h4>
                                <p>+256 778997909</p>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class="fab fa-whatsapp"></i>
                            <div>
                                <h4>WhatsApp</h4>
                                <p>+256 778997909</p>
                            </div>
                        </div>
                        
                        <h3 class="social-title"><i class="fas fa-share-alt"></i> Social Media</h3>
                        
                        <div class="social-links">
                            <a href="https://www.tiktok.com/@fx_tae_trader" class="social-link" target="_blank">
                                <i class="fab fa-tiktok"></i> @fx_tae_trader
                            </a>
                            
                            <a href="https://www.instagram.com/fxtaetrader" class="social-link" target="_blank">
                                <i class="fab fa-instagram"></i> @fxtaetrader
                            </a>
                            
                            <a href="https://www.youtube.com/@fxtaetrader" class="social-link" target="_blank">
                                <i class="fab fa-youtube"></i> @fxtaetrader
                            </a>
                            
                            <a href="https://www.facebook.com/fxtaetrader" class="social-link" target="_blank">
                                <i class="fab fa-facebook"></i> @FXTaeTrader
                            </a>
                        </div>
                    </div>
                    
                    <div class="mentorship-card">
                        <div class="mentorship-badge">
                            <i class="fas fa-crown"></i> 1% CIRCLE
                        </div>
                        <h3><i class="fas fa-graduation-cap"></i> Join 1% Trading Circle</h3>
                        <p>Ready to level up your trading? Join FX Tae's exclusive mentorship program for personalized coaching, advanced strategies, and direct mentorship.</p>
                        <a href="https://fxtaetrader.page.gd/" class="mentorship-btn" target="_blank">
                            <i class="fas fa-rocket"></i> Apply for Mentorship
                        </a>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals -->
    <div class="modal" id="editBalanceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Account Balance</h3>
                <button class="close-modal" onclick="closeEditBalanceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>New Account Balance ($)</label>
                    <input type="number" id="newBalanceInput" class="form-input" placeholder="Enter new balance">
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="confirmBalanceUpdate()">Update Balance</button>
                    <button class="btn-outline" onclick="closeEditBalanceModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="editTradesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Edit Today's Trades</h3>
                <button class="close-modal" onclick="closeEditTradesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="todayTradesEditList"></div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="saveEditedTrades()">Save Changes</button>
                    <button class="btn-outline" onclick="closeEditTradesModal()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- JAVASCRIPT -->
    <script>
// Initialize Dashboard
document.addEventListener('DOMContentLoaded', function() {
    // Disable zoom
    document.addEventListener('touchmove', function(e) {
        if (e.scale !== 1) { e.preventDefault(); }
    }, { passive: false });
    
    document.addEventListener('gesturestart', function(e) {
        e.preventDefault();
    });
    
    // Simulate loading
    setTimeout(() => {
        document.getElementById('loader').style.display = 'none';
        document.getElementById('mainContainer').style.display = 'block';
        setTimeout(() => {
            document.getElementById('mainContainer').classList.add('show');
        }, 100);
        
        // Initialize dashboard
        initializeDashboard();
    }, 2000);
});

// Global Variables
let currentTrades = [];
let dreams = [];
let accountBalance = 0;
let startingBalance = 0;
let settings = {
    dailyMaxLoss: 2,
    dailyTradeLimit: 4,
    riskPerTrade: 1,
    tradingHours: '24/7',
    theme: 'light'
};

// Current month tracking for equity curve
let currentChartPeriod = '1m';
let currentMonth = new Date().getMonth();
let currentYear = new Date().getFullYear();

// Initialize Dashboard
function initializeDashboard() {
    loadData();
    setupEventListeners();
    updateUI();
    initializeCharts();
    updateCurrentDateTime();
    
    // Update time every minute
    setInterval(updateCurrentDateTime, 60000);
    
    // Show welcome toast
    showToast('Welcome to FX TAE Trading Dashboard!', 'success');
}

// Load data from localStorage
function loadData() {
    // Load trades
    const savedTrades = localStorage.getItem('fxTaeTrades');
    if (savedTrades) {
        currentTrades = JSON.parse(savedTrades);
    }
    
    // Load dreams
    const savedDreams = localStorage.getItem('fxTaeDreams');
    if (savedDreams) {
        dreams = JSON.parse(savedDreams);
    }
    
    // Load settings
    const savedSettings = localStorage.getItem('fxTaeSettings');
    if (savedSettings) {
        settings = JSON.parse(savedSettings);
    }
    
    // Load balance
    const savedBalance = localStorage.getItem('fxTaeBalance');
    if (savedBalance) {
        accountBalance = parseFloat(savedBalance);
    }
    
    const savedStartingBalance = localStorage.getItem('fxTaeStartingBalance');
    if (savedStartingBalance) {
        startingBalance = parseFloat(savedStartingBalance);
    }
    
    // Apply theme
    if (settings.theme === 'dark') {
        document.body.classList.add('dark-theme');
        document.getElementById('darkThemeBtn')?.classList.add('active');
        document.getElementById('lightThemeBtn')?.classList.remove('active');
    }
}

// Save data to localStorage
function saveData() {
    localStorage.setItem('fxTaeTrades', JSON.stringify(currentTrades));
    localStorage.setItem('fxTaeDreams', JSON.stringify(dreams));
    localStorage.setItem('fxTaeSettings', JSON.stringify(settings));
    localStorage.setItem('fxTaeBalance', accountBalance.toString());
    localStorage.setItem('fxTaeStartingBalance', startingBalance.toString());
}

// Setup Event Listeners
function setupEventListeners() {
    // Menu toggle
    const menuBtn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    
    menuBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        menuBtn.classList.toggle('active');
        sidebar.classList.toggle('show');
    });
    
    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
        if (window.innerWidth <= 768 && sidebar.classList.contains('show')) {
            if (!sidebar.contains(e.target) && !menuBtn.contains(e.target)) {
                sidebar.classList.remove('show');
                menuBtn.classList.remove('active');
            }
        }
    });
    
    // Navigation
    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            const page = this.getAttribute('data-page');
            navigateToPage(page);
            
            // Close sidebar on mobile after navigation
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('show');
                menuBtn.classList.remove('active');
            }
        });
    });
    
    // Logout button
    document.getElementById('logoutBtn').addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
            showToast('Logged out successfully', 'info');
            setTimeout(() => {
                document.getElementById('loader').style.display = 'flex';
                document.getElementById('mainContainer').style.display = 'none';
                setTimeout(() => {
                    document.getElementById('loader').style.display = 'none';
                    showLoginScreen();
                }, 1000);
            }, 500);
        }
    });
    
    // Initialize form date to today
    document.getElementById('tradeDate').valueAsDate = new Date();
    
    // Auto-fill time to current time
    updateTradeTime();
    
    // Set starting balance to 0 by default
    if (!localStorage.getItem('fxTaeStartingBalance')) {
        startingBalance = 0;
        document.getElementById('startingBalance').textContent = '$0.00';
    }
}

// Update trade time
function updateTradeTime() {
    const now = new Date();
    const timeString = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
    document.getElementById('tradeTime').value = timeString;
}

// Navigate to Page
function navigateToPage(page) {
    // Update active nav item
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-page') === page) {
            item.classList.add('active');
        }
    });
    
    // Show selected page
    document.querySelectorAll('.page').forEach(pageElement => {
        pageElement.classList.remove('active');
    });
    document.getElementById(page).classList.add('active');
    
    // Update specific page data
    if (page === 'journal') {
        updateJournalTable();
    } else if (page === 'analytics') {
        updateAnalytics();
        updateCalendar();
    } else if (page === 'notebook') {
        updateDreamsList();
    } else if (page === 'settings') {
        loadSettingsToForm();
    }
}

// Update Current Date and Time
function updateCurrentDateTime() {
    const now = new Date();
    const options = { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    };
    document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', options);
}

// Update UI
function updateUI() {
    updateBalanceDisplay();
    updateTodayStats();
    updateWeeklyStats();
    updateMonthlyStats();
    updateRecentTrades();
    updateAccountBalanceManager();
}

// Update Balance Display
function updateBalanceDisplay() {
    const balanceElement = document.getElementById('accountBalance');
    const currentBalanceInput = document.getElementById('currentBalanceInput');
    
    balanceElement.textContent = formatCurrency(accountBalance);
    currentBalanceInput.value = accountBalance.toFixed(2);
    
    // Update starting balance display
    document.getElementById('startingBalance').textContent = formatCurrency(startingBalance);
    
    // Calculate growth
    const totalGrowth = accountBalance - startingBalance;
    const growthPercentage = startingBalance > 0 ? (totalGrowth / startingBalance * 100).toFixed(2) : 0;
    
    document.getElementById('totalGrowth').textContent = formatCurrency(totalGrowth);
    document.getElementById('growthPercentage').textContent = `${growthPercentage}%`;
    
    // Update color for growth
    const growthElement = document.getElementById('growthPercentage');
    if (totalGrowth > 0) {
        growthElement.style.color = 'var(--success)';
    } else if (totalGrowth < 0) {
        growthElement.style.color = 'var(--danger)';
    } else {
        growthElement.style.color = 'var(--gray)';
    }
}

// Update Today's Stats
function updateTodayStats() {
    const today = new Date().toDateString();
    const todayTrades = currentTrades.filter(trade => {
        const tradeDate = new Date(trade.date + ' ' + trade.time).toDateString();
        return tradeDate === today;
    });
    
    const todayProfit = todayTrades.reduce((sum, trade) => sum + parseFloat(trade.pnl), 0);
    const winningTrades = todayTrades.filter(trade => parseFloat(trade.pnl) > 0).length;
    const losingTrades = todayTrades.filter(trade => parseFloat(trade.pnl) < 0).length;
    
    // Update today's P&L
    const todayPnlElement = document.getElementById('todayPnl');
    todayPnlElement.textContent = formatCurrency(todayProfit);
    todayPnlElement.style.color = todayProfit > 0 ? 'var(--success)' : todayProfit < 0 ? 'var(--danger)' : 'var(--gray)';
    
    // Update today's trades count
    const todayTradesCount = todayTrades.length;
    const tradeLimit = settings.dailyTradeLimit || 4;
    const todayTradesCountElement = document.getElementById('todayTradesCount');
    todayTradesCountElement.textContent = `${todayTradesCount}/${tradeLimit}`;
    todayTradesCountElement.style.color = todayTradesCount >= tradeLimit ? 'var(--danger)' : todayTradesCount > 0 ? 'var(--success)' : 'var(--gray)';
    
    // Update progress bar
    const progressPercent = Math.min((todayTradesCount / tradeLimit) * 100, 100);
    const progressFill = document.querySelector('.progress-fill');
    if (progressFill) {
        progressFill.style.width = `${progressPercent}%`;
        progressFill.style.background = todayTradesCount >= tradeLimit ? 'var(--danger)' : 'linear-gradient(90deg, var(--secondary), var(--primary))';
    }
    
    // Update trade details
    const detailsElement = document.getElementById('todayTradesList');
    if (todayTrades.length > 0) {
        const tradeDetails = todayTrades.map(trade => 
            `${trade.currencyPair}: ${parseFloat(trade.pnl) >= 0 ? '+' : ''}${formatCurrency(trade.pnl)}`
        ).join('  ');
        detailsElement.textContent = tradeDetails;
    } else {
        detailsElement.textContent = 'No trades today';
    }
    
    // Update status message
    const changeElement = document.getElementById('todayChange');
    if (todayTrades.length > 0) {
        changeElement.textContent = `${winningTrades}W ${losingTrades}L  ${todayProfit > 0 ? 'Profit' : todayProfit < 0 ? 'Loss' : 'Even'}`;
        changeElement.style.color = todayProfit > 0 ? 'var(--success)' : todayProfit < 0 ? 'var(--danger)' : 'var(--gray)';
    } else {
        changeElement.textContent = 'Start trading to see performance';
        changeElement.style.color = 'var(--gray)';
    }
}

// Update Weekly Stats
function updateWeeklyStats() {
    const now = new Date();
    const startOfWeek = new Date(now);
    startOfWeek.setDate(now.getDate() - now.getDay());
    startOfWeek.setHours(0, 0, 0, 0);
    
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate() + 6);
    endOfWeek.setHours(23, 59, 59, 999);
    
    const weeklyTrades = currentTrades.filter(trade => {
        const tradeDate = new Date(trade.date + ' ' + trade.time);
        return tradeDate >= startOfWeek && tradeDate <= endOfWeek;
    });
    
    const weeklyProfit = weeklyTrades.reduce((sum, trade) => sum + parseFloat(trade.pnl), 0);
    const winningTrades = weeklyTrades.filter(trade => parseFloat(trade.pnl) > 0).length;
    const losingTrades = weeklyTrades.filter(trade => parseFloat(trade.pnl) < 0).length;
    
    const weeklyPnlElement = document.getElementById('weeklyPnl');
    weeklyPnlElement.textContent = formatCurrency(weeklyProfit);
    weeklyPnlElement.style.color = weeklyProfit > 0 ? 'var(--success)' : weeklyProfit < 0 ? 'var(--danger)' : 'var(--gray)';
    
    const detailsElement = document.getElementById('weeklyTradesList');
    if (weeklyTrades.length > 0) {
        detailsElement.textContent = `${weeklyTrades.length} trades  ${winningTrades} wins`;
    } else {
        detailsElement.textContent = 'No weekly trades';
    }
    
    const changeElement = document.getElementById('weeklyChange');
    if (weeklyTrades.length > 0) {
        changeElement.textContent = `${winningTrades}W ${losingTrades}L  ${weeklyProfit > 0 ? 'Profit' : weeklyProfit < 0 ? 'Loss' : 'Even'}`;
        changeElement.style.color = weeklyProfit > 0 ? 'var(--success)' : weeklyProfit < 0 ? 'var(--danger)' : 'var(--gray)';
    } else {
        changeElement.textContent = 'Weekly performance will appear here';
        changeElement.style.color = 'var(--gray)';
    }
}

// Update Monthly Stats
function updateMonthlyStats() {
    const now = new Date();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();
    
    const monthlyTrades = currentTrades.filter(trade => {
        const tradeDate = new Date(trade.date + ' ' + trade.time);
        return tradeDate.getMonth() === currentMonth && tradeDate.getFullYear() === currentYear;
    });
    
    const monthlyProfit = monthlyTrades.reduce((sum, trade) => sum + parseFloat(trade.pnl), 0);
    const winningTrades = monthlyTrades.filter(trade => parseFloat(trade.pnl) > 0).length;
    const losingTrades = monthlyTrades.filter(trade => parseFloat(trade.pnl) < 0).length;
    
    const monthlyPnlElement = document.getElementById('monthlyPnl');
    monthlyPnlElement.textContent = formatCurrency(monthlyProfit);
    monthlyPnlElement.style.color = monthlyProfit > 0 ? 'var(--success)' : monthlyProfit < 0 ? 'var(--danger)' : 'var(--gray)';
    
    const detailsElement = document.getElementById('monthlyTradesList');
    if (monthlyTrades.length > 0) {
        detailsElement.textContent = `${monthlyTrades.length} trades  ${winningTrades} wins`;
    } else {
        detailsElement.textContent = 'No monthly trades';
    }
    
    const changeElement = document.getElementById('monthlyChange');
    if (monthlyTrades.length > 0) {
        changeElement.textContent = `${winningTrades}W ${losingTrades}L  ${monthlyProfit > 0 ? 'Profit' : monthlyProfit < 0 ? 'Loss' : 'Even'}`;
        changeElement.style.color = monthlyProfit > 0 ? 'var(--success)' : monthlyProfit < 0 ? 'var(--danger)' : 'var(--gray)';
    } else {
        changeElement.textContent = 'Monthly performance will appear here';
        changeElement.style.color = 'var(--gray)';
    }
}

// Update Recent Trades Table
function updateRecentTrades() {
    const tableBody = document.getElementById('recentTradesTable');
    const allTradesTable = document.getElementById('allTradesTable');
    
    // Clear tables
    tableBody.innerHTML = '';
    allTradesTable.innerHTML = '';
    
    // Sort trades by date (newest first)
    const sortedTrades = [...currentTrades].sort((a, b) => {
        return new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + a.time);
    });
    
    // Add to recent trades (last 10)
    const recentTrades = sortedTrades.slice(0, 10);
    
    recentTrades.forEach(trade => {
        const row = createTradeTableRow(trade);
        tableBody.appendChild(row);
    });
    
    // Add to all trades table
    sortedTrades.forEach(trade => {
        const row = createTradeTableRow(trade, true);
        allTradesTable.appendChild(row);
    });
}

// Create Trade Table Row
function createTradeTableRow(trade, showNotes = false) {
    const row = document.createElement('tr');
    
    const pnl = parseFloat(trade.pnl);
    const isWin = pnl > 0;
    const statusClass = isWin ? 'status-win' : 'status-loss';
    const statusText = isWin ? 'Win' : 'Loss';
    
    let notesContent = trade.notes || '-';
    if (!showNotes) {
        notesContent = notesContent.length > 30 ? notesContent.substring(0, 30) + '...' : notesContent;
    }
    
    row.innerHTML = `
        <td>${trade.date} ${trade.time}</td>
        <td>${trade.tradeNumber}</td>
        <td>${trade.currencyPair}</td>
        <td>${trade.strategy}</td>
        <td style="color: ${isWin ? 'var(--success)' : 'var(--danger)'}; font-weight: 600;">
            ${pnl >= 0 ? '+' : ''}${formatCurrency(pnl)}
        </td>
        ${showNotes ? `<td>${notesContent}</td>` : ''}
        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
        <td class="table-actions">
            <button class="action-btn" onclick="editTrade('${trade.id}')" title="Edit Trade">
                <i class="fas fa-edit"></i>
            </button>
            <button class="action-btn" onclick="deleteTrade('${trade.id}')" title="Delete Trade">
                <i class="fas fa-trash"></i>
            </button>
        </td>
    `;
    
    return row;
}

// Update Account Balance Manager
function updateAccountBalanceManager() {
    document.getElementById('currentBalanceInput').value = accountBalance.toFixed(2);
    document.getElementById('startingBalance').textContent = formatCurrency(startingBalance);
    
    const totalGrowth = accountBalance - startingBalance;
    const growthPercentage = startingBalance > 0 ? (totalGrowth / startingBalance * 100).toFixed(2) : 0;
    
    document.getElementById('totalGrowth').textContent = formatCurrency(totalGrowth);
    document.getElementById('growthPercentage').textContent = `${growthPercentage}%`;
    
    // Update color for growth
    const growthElement = document.getElementById('growthPercentage');
    if (totalGrowth > 0) {
        growthElement.style.color = 'var(--success)';
    } else if (totalGrowth < 0) {
        growthElement.style.color = 'var(--danger)';
    } else {
        growthElement.style.color = 'var(--gray)';
    }
}

// Save Trade
function saveTrade() {
    const tradeForm = document.getElementById('tradeForm');
    
    // Validate form
    if (!document.getElementById('tradeDate').value) {
        showToast('Please select a date', 'error');
        return;
    }
    
    if (!document.getElementById('pnlAmount').value || parseFloat(document.getElementById('pnlAmount').value) === 0) {
        showToast('Please enter a valid P&L amount', 'error');
        return;
    }
    
    // Check daily trade limit
    const today = new Date().toDateString();
    const todayTrades = currentTrades.filter(trade => {
        const tradeDate = new Date(trade.date + ' ' + trade.time).toDateString();
        return tradeDate === today;
    });
    
    const tradeLimit = settings.dailyTradeLimit || 4;
    if (todayTrades.length >= tradeLimit) {
        showToast(`Daily trade limit (${tradeLimit}) reached!`, 'warning');
        return;
    }
    
    // Create trade object
    const trade = {
        id: generateId(),
        date: document.getElementById('tradeDate').value,
        time: document.getElementById('tradeTime').value,
        tradeNumber: document.getElementById('tradeNumber').value,
        strategy: document.getElementById('customStrategy').style.display !== 'none' 
            ? document.getElementById('customStrategy').value 
            : document.getElementById('strategy').value,
        currencyPair: document.getElementById('currencyPair').value,
        pnl: parseFloat(document.getElementById('pnlAmount').value).toFixed(2),
        notes: document.getElementById('tradeNotes').value || '',
        timestamp: new Date().getTime()
    };
    
    // Add trade to array
    currentTrades.push(trade);
    
    // Update balance
    accountBalance += parseFloat(trade.pnl);
    
    // Check if month has changed - reset starting balance
    const tradeDate = new Date(trade.date + ' ' + trade.time);
    if (tradeDate.getMonth() !== currentMonth || tradeDate.getFullYear() !== currentYear) {
        // Month changed, reset starting balance
        startingBalance = accountBalance;
        currentMonth = tradeDate.getMonth();
        currentYear = tradeDate.getFullYear();
        showToast('New month started - starting balance reset', 'info');
    }
    
    // Save data
    saveData();
    
    // Update UI
    updateUI();
    updateCharts();
    
    // Reset form
    resetTradeForm();
    
    showToast('Trade saved successfully!', 'success');
}

// Reset Trade Form
function resetTradeForm() {
    document.getElementById('tradeForm').reset();
    document.getElementById('tradeDate').valueAsDate = new Date();
    updateTradeTime();
    document.getElementById('customStrategy').style.display = 'none';
}

// Save and Download Trade PDF
async function saveAndDownloadTrade() {
    // First save the trade
    saveTrade();
    
    if (currentTrades.length === 0) return;
    
    // Generate trade summary
    const tradeData = currentTrades[currentTrades.length - 1];
    
    try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        
        // Set font to bold
        pdf.setFont(undefined, 'bold');
        pdf.setFontSize(20);
        pdf.setTextColor(0, 82, 204);
        pdf.text('FX TAE TRADE RECEIPT', 105, 20, { align: 'center' });
        
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        pdf.text(`Trade ID: ${tradeData.id.substring(0, 8)}`, 20, 40);
        pdf.text(`Date: ${tradeData.date} ${tradeData.time}`, 20, 50);
        
        pdf.setFontSize(14);
        pdf.text('Trade Details', 20, 70);
        
        pdf.setFontSize(12);
        let yPos = 80;
        const details = [
            `Trade #: ${tradeData.tradeNumber}`,
            `Instrument: ${tradeData.currencyPair}`,
            `Strategy: ${tradeData.strategy}`,
            `P&L: ${parseFloat(tradeData.pnl) >= 0 ? '+' : ''}${formatCurrency(parseFloat(tradeData.pnl))}`,
            `Status: ${parseFloat(tradeData.pnl) >= 0 ? 'WIN' : 'LOSS'}`,
            `Notes: ${tradeData.notes || 'None'}`
        ];
        
        details.forEach(detail => {
            pdf.text(detail, 30, yPos);
            yPos += 8;
        });
        
        // Add summary
        yPos += 10;
        pdf.setFontSize(14);
        pdf.text('Account Summary', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(12);
        pdf.text(`New Balance: ${formatCurrency(accountBalance)}`, 30, yPos);
        yPos += 8;
        pdf.text(`Starting Balance: ${formatCurrency(startingBalance)}`, 30, yPos);
        yPos += 8;
        pdf.text(`Growth: ${formatCurrency(accountBalance - startingBalance)}`, 30, yPos);
        
        // Footer
        pdf.setFontSize(10);
        pdf.setTextColor(100, 100, 100);
        pdf.text('Generated by FX TAE Trading Dashboard', 105, 280, { align: 'center' });
        
        // Save the PDF
        const fileName = `FX_TAE_Trade_${tradeData.date.replace(/-/g, '')}_${tradeData.tradeNumber}.pdf`;
        pdf.save(fileName);
        
        showToast('Trade PDF downloaded', 'success');
    } catch (error) {
        console.error('Error generating PDF:', error);
        showToast('Error downloading PDF', 'error');
    }
}

// Generate ID
function generateId() {
    return 'trade_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
}

// Format Currency
function formatCurrency(amount) {
    return new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    }).format(amount);
}

// Show Custom Strategy Input
function showCustomStrategy() {
    const customInput = document.getElementById('customStrategy');
    customInput.style.display = 'block';
    customInput.focus();
}

// Initialize Charts
function initializeCharts() {
    // Equity Curve Chart
    const equityCtx = document.getElementById('equityChart').getContext('2d');
    window.equityChart = new Chart(equityCtx, {
        type: 'line',
        data: {
            labels: generateDateLabels(30),
            datasets: [{
                label: 'Account Balance',
                data: generateEquityData(30),
                borderColor: '#0052CC',
                backgroundColor: 'rgba(0, 82, 204, 0.1)',
                borderWidth: 2,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#0052CC',
                pointBorderColor: '#FFFFFF',
                pointBorderWidth: 2,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                    callbacks: {
                        label: function(context) {
                            return `Balance: ${formatCurrency(context.parsed.y)}`;
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        display: false
                    }
                },
                y: {
                    beginAtZero: false,
                    ticks: {
                        callback: function(value) {
                            return formatCurrency(value);
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'nearest'
            }
        }
    });
    
    // Win Rate Chart
    const winRateCtx = document.getElementById('winRateChart').getContext('2d');
    window.winRateChart = new Chart(winRateCtx, {
        type: 'doughnut',
        data: {
            labels: ['Winning Trades', 'Losing Trades'],
            datasets: [{
                data: calculateWinRate(),
                backgroundColor: [
                    '#36B37E',
                    '#FF5630'
                ],
                borderWidth: 2,
                borderColor: 'white',
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true,
                        pointStyle: 'circle'
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = Math.round((context.parsed / total) * 100);
                            return `${context.label}: ${context.parsed} (${percentage}%)`;
                        }
                    }
                }
            }
        }
    });
    
    // Update win rate value
    const winRate = calculateWinRate();
    const winRatePercentage = winRate[0] > 0 ? Math.round((winRate[0] / (winRate[0] + winRate[1])) * 100) : 0;
    document.getElementById('winRateValue').textContent = `${winRatePercentage}%`;
    
    // Initialize Analytics Charts
    initializeAnalyticsCharts();
}

// Initialize Analytics Charts
function initializeAnalyticsCharts() {
    // Average Win vs Loss Chart (Half Donut)
    const avgWinLossCtx = document.getElementById('avgWinLossChart').getContext('2d');
    window.avgWinLossChart = new Chart(avgWinLossCtx, {
        type: 'doughnut',
        data: {
            labels: ['Average Win', 'Average Loss'],
            datasets: [{
                data: [0, 0],
                backgroundColor: ['#36B37E', '#FF5630'],
                borderWidth: 2,
                borderColor: 'white'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            circumference: 180,
            rotation: -90,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
    
    // Profit Distribution Chart (Half Donut)
    const profitDistCtx = document.getElementById('profitDistributionChart').getContext('2d');
    window.profitDistributionChart = new Chart(profitDistCtx, {
        type: 'doughnut',
        data: {
            labels: ['Profit', 'Loss'],
            datasets: [{
                data: [0, 0],
                backgroundColor: ['#36B37E', '#FF5630'],
                borderWidth: 2,
                borderColor: 'white'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            circumference: 180,
            rotation: -90,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
    
    // Long vs Short Chart (Horizontal Bar)
    const longShortCtx = document.getElementById('longShortChart').getContext('2d');
    window.longShortChart = new Chart(longShortCtx, {
        type: 'bar',
        data: {
            labels: ['Long', 'Short'],
            datasets: [{
                label: 'Number of Trades',
                data: [0, 0],
                backgroundColor: ['#0052CC', '#6554C0'],
                borderWidth: 1,
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            indexAxis: 'y',
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                x: {
                    beginAtZero: true,
                    grid: {
                        display: false
                    }
                },
                y: {
                    grid: {
                        display: false
                    }
                }
            }
        }
    });
    
    // Win/Loss Chart (Pie)
    const winLossCtx = document.getElementById('winLossChart').getContext('2d');
    window.winLossChart = new Chart(winLossCtx, {
        type: 'pie',
        data: {
            labels: ['Winning', 'Losing'],
            datasets: [{
                data: [0, 0],
                backgroundColor: ['#36B37E', '#FF5630'],
                borderWidth: 2,
                borderColor: 'white'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });
}

// Generate Date Labels for Equity Curve
function generateDateLabels(days) {
    const labels = [];
    for (let i = days - 1; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
    }
    return labels;
}

// Generate Equity Data with daily P&L
function generateEquityData(days) {
    const data = [];
    let runningBalance = startingBalance;
    
    // Get trades grouped by day
    const tradesByDay = {};
    currentTrades.forEach(trade => {
        const tradeDate = new Date(trade.date + ' ' + trade.time);
        const dateKey = tradeDate.toDateString();
        if (!tradesByDay[dateKey]) {
            tradesByDay[dateKey] = 0;
        }
        tradesByDay[dateKey] += parseFloat(trade.pnl);
    });
    
    // Generate data for last N days
    for (let i = days - 1; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateKey = date.toDateString();
        
        if (tradesByDay[dateKey]) {
            runningBalance += tradesByDay[dateKey];
        }
        
        // Only include days with trades
        if (tradesByDay[dateKey] !== undefined) {
            data.push(runningBalance);
        } else {
            // For no-trade days, maintain previous balance
            data.push(data.length > 0 ? data[data.length - 1] : runningBalance);
        }
    }
    
    return data;
}

// Calculate Win Rate
function calculateWinRate() {
    if (currentTrades.length === 0) return [0, 0];
    
    const winningTrades = currentTrades.filter(trade => parseFloat(trade.pnl) > 0).length;
    const losingTrades = currentTrades.filter(trade => parseFloat(trade.pnl) < 0).length;
    
    return [winningTrades, losingTrades];
}

// Update Charts
function updateCharts() {
    if (!window.equityChart || !window.winRateChart) return;
    
    // Update equity chart based on current period
    const days = currentChartPeriod === '1m' ? 30 : 365;
    window.equityChart.data.labels = generateDateLabels(days);
    window.equityChart.data.datasets[0].data = generateEquityData(days);
    window.equityChart.update();
    
    // Update win rate chart
    const winRate = calculateWinRate();
    window.winRateChart.data.datasets[0].data = winRate;
    window.winRateChart.update();
    
    // Update win rate value
    const winRatePercentage = winRate[0] > 0 ? Math.round((winRate[0] / (winRate[0] + winRate[1])) * 100) : 0;
    document.getElementById('winRateValue').textContent = `${winRatePercentage}%`;
    
    // Update analytics charts
    updateAnalyticsCharts();
}

// Update Analytics Charts
function updateAnalyticsCharts() {
    if (!window.avgWinLossChart) return;
    
    // Calculate average win/loss
    const winningTrades = currentTrades.filter(t => parseFloat(t.pnl) > 0);
    const losingTrades = currentTrades.filter(t => parseFloat(t.pnl) < 0);
    
    const avgWin = winningTrades.length > 0 ? 
        winningTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / winningTrades.length : 0;
    const avgLoss = losingTrades.length > 0 ? 
        Math.abs(losingTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0)) / losingTrades.length : 0;
    
    // Update Average Win vs Loss Chart
    window.avgWinLossChart.data.datasets[0].data = [avgWin, avgLoss];
    window.avgWinLossChart.update();
    document.getElementById('avgWinLossRatio').textContent = avgLoss > 0 ? (avgWin / avgLoss).toFixed(2) : '0.0';
    
    // Calculate profit distribution
    const totalProfit = currentTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0);
    const profitAmount = Math.max(0, totalProfit);
    const lossAmount = Math.abs(Math.min(0, totalProfit));
    
    // Update Profit Distribution Chart
    window.profitDistributionChart.data.datasets[0].data = [profitAmount, lossAmount];
    window.profitDistributionChart.update();
    document.getElementById('totalProfitValue').textContent = formatCurrency(totalProfit);
    
    // Update Long vs Short Chart (placeholder - would need trade direction data)
    window.longShortChart.data.datasets[0].data = [winningTrades.length, losingTrades.length];
    window.longShortChart.update();
    document.getElementById('longShortRatio').textContent = `${winningTrades.length}:${losingTrades.length}`;
    
    // Update Win/Loss Chart
    window.winLossChart.data.datasets[0].data = [winningTrades.length, losingTrades.length];
    window.winLossChart.update();
    const winRate = winningTrades.length > 0 ? 
        Math.round((winningTrades.length / currentTrades.length) * 100) : 0;
    document.getElementById('winLossRatio').textContent = `${winRate}%`;
}

// Update Chart Period
function updateChartPeriod(period) {
    const buttons = document.querySelectorAll('.period-btn');
    buttons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    currentChartPeriod = period;
    updateCharts();
}

// Download Chart
function downloadChart(chartId, filename) {
    const canvas = document.getElementById(chartId);
    
    try {
        // Create a new canvas with higher resolution
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        
        // Set higher resolution
        const scale = 3;
        tempCanvas.width = canvas.width * scale;
        tempCanvas.height = canvas.height * scale;
        
        // Draw with high quality
        tempCtx.scale(scale, scale);
        tempCtx.drawImage(canvas, 0, 0);
        
        // Create download link
        const link = document.createElement('a');
        link.download = `${filename}_${new Date().toISOString().split('T')[0]}.png`;
        link.href = tempCanvas.toDataURL('image/png');
        link.click();
        
        showToast('Chart downloaded successfully', 'success');
    } catch (error) {
        console.error('Error downloading chart:', error);
        showToast('Error downloading chart', 'error');
    }
}

// Edit Starting Balance
let originalStartingBalance = startingBalance;

function editStartingBalance() {
    const display = document.getElementById('startingBalance');
    const input = document.getElementById('startingBalanceInput');
    const saveBtn = document.getElementById('saveBalanceBtn');
    const cancelBtn = document.getElementById('cancelBalanceBtn');
    
    // Store original value
    originalStartingBalance = startingBalance;
    
    // Show input, hide display
    display.style.display = 'none';
    input.style.display = 'block';
    saveBtn.style.display = 'inline-block';
    cancelBtn.style.display = 'inline-block';
    
    // Set input value
    input.value = startingBalance;
    input.focus();
}

function saveStartingBalance() {
    const input = document.getElementById('startingBalanceInput');
    const newBalance = parseFloat(input.value);
    
    if (isNaN(newBalance) || newBalance < 0) {
        showToast('Please enter a valid positive number', 'error');
        return;
    }
    
    startingBalance = newBalance;
    
    // Update display
    document.getElementById('startingBalance').textContent = formatCurrency(startingBalance);
    
    // Hide input and buttons
    cancelStartingBalanceEdit();
    
    // Update charts and stats
    updateUI();
    updateCharts();
    saveData();
    
    showToast('Starting balance updated successfully', 'success');
}

function cancelStartingBalanceEdit() {
    const display = document.getElementById('startingBalance');
    const input = document.getElementById('startingBalanceInput');
    const saveBtn = document.getElementById('saveBalanceBtn');
    const cancelBtn = document.getElementById('cancelBalanceBtn');
    
    // Restore original value
    startingBalance = originalStartingBalance;
    
    // Show display, hide input and buttons
    display.style.display = 'block';
    input.style.display = 'none';
    saveBtn.style.display = 'none';
    cancelBtn.style.display = 'none';
    
    // Update display
    display.textContent = formatCurrency(startingBalance);
}

// Edit Today's Trades
function editTodayTrades() {
    const today = new Date().toDateString();
    const todayTrades = currentTrades.filter(trade => {
        const tradeDate = new Date(trade.date + ' ' + trade.time).toDateString();
        return tradeDate === today;
    });
    
    if (todayTrades.length === 0) {
        showToast('No trades to edit today', 'info');
        return;
    }
    
    const editList = document.getElementById('todayTradesEditList');
    editList.innerHTML = '';
    
    todayTrades.forEach((trade, index) => {
        const tradeDiv = document.createElement('div');
        tradeDiv.className = 'trade-edit-item';
        tradeDiv.style.marginBottom = '1rem';
        tradeDiv.style.padding = '1rem';
        tradeDiv.style.border = '1px solid var(--gray-light)';
        tradeDiv.style.borderRadius = 'var(--border-radius)';
        tradeDiv.innerHTML = `
            <div class="trade-edit-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h4 style="margin: 0;">Trade ${trade.tradeNumber} - ${trade.currencyPair}</h4>
                <span style="color: ${parseFloat(trade.pnl) >= 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: 600;">
                    ${parseFloat(trade.pnl) >= 0 ? '+' : ''}${formatCurrency(parseFloat(trade.pnl))}
                </span>
            </div>
            <div class="trade-edit-form" style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label>P&L ($)</label>
                    <input type="number" step="0.01" class="form-input trade-pnl-input" 
                           data-id="${trade.id}" value="${trade.pnl}" placeholder="Enter new P&L" style="width: 100%;">
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <input type="text" class="form-input trade-notes-input" 
                           data-id="${trade.id}" value="${trade.notes}" placeholder="Update notes" style="width: 100%;">
                </div>
            </div>
        `;
        editList.appendChild(tradeDiv);
    });
    
    // Show modal
    const modal = document.getElementById('editTradesModal');
    modal.classList.add('show');
    modal.style.display = 'flex';
}

function saveEditedTrades() {
    const pnlInputs = document.querySelectorAll('.trade-pnl-input');
    const notesInputs = document.querySelectorAll('.trade-notes-input');
    
    let totalPnlChange = 0;
    
    pnlInputs.forEach(input => {
        const tradeId = input.getAttribute('data-id');
        const newPnl = parseFloat(input.value);
        const tradeIndex = currentTrades.findIndex(t => t.id === tradeId);
        
        if (tradeIndex > -1 && !isNaN(newPnl)) {
            const oldPnl = parseFloat(currentTrades[tradeIndex].pnl);
            currentTrades[tradeIndex].pnl = newPnl.toFixed(2);
            totalPnlChange += (newPnl - oldPnl);
        }
    });
    
    notesInputs.forEach(input => {
        const tradeId = input.getAttribute('data-id');
        const tradeIndex = currentTrades.findIndex(t => t.id === tradeId);
        
        if (tradeIndex > -1) {
            currentTrades[tradeIndex].notes = input.value;
        }
    });
    
    // Update account balance
    if (totalPnlChange !== 0) {
        accountBalance += totalPnlChange;
    }
    
    // Save data
    saveData();
    
    // Update UI
    updateUI();
    updateCharts();
    
    closeEditTradesModal();
    showToast('Trades updated successfully', 'success');
}

function closeEditTradesModal() {
    const modal = document.getElementById('editTradesModal');
    modal.classList.remove('show');
    modal.style.display = 'none';
}

// Edit Trade
function editTrade(tradeId) {
    const trade = currentTrades.find(t => t.id === tradeId);
    if (!trade) return;
    
    // Populate form with trade data
    document.getElementById('tradeDate').value = trade.date;
    document.getElementById('tradeTime').value = trade.time;
    document.getElementById('tradeNumber').value = trade.tradeNumber;
    document.getElementById('strategy').value = trade.strategy;
    document.getElementById('currencyPair').value = trade.currencyPair;
    document.getElementById('pnlAmount').value = trade.pnl;
    document.getElementById('tradeNotes').value = trade.notes;
    
    // Remove the trade from array
    const tradeIndex = currentTrades.findIndex(t => t.id === tradeId);
    if (tradeIndex > -1) {
        // Adjust balance
        accountBalance -= parseFloat(trade.pnl);
        currentTrades.splice(tradeIndex, 1);
    }
    
    // Navigate to dashboard
    navigateToPage('dashboard');
    
    showToast('Trade loaded for editing. Make changes and save.', 'info');
}

// Delete Trade
function deleteTrade(tradeId) {
    if (!confirm('Are you sure you want to delete this trade?')) return;
    
    const tradeIndex = currentTrades.findIndex(t => t.id === tradeId);
    if (tradeIndex > -1) {
        // Adjust balance
        const trade = currentTrades[tradeIndex];
        accountBalance -= parseFloat(trade.pnl);
        
        // Remove trade
        currentTrades.splice(tradeIndex, 1);
        
        // Save data
        saveData();
        
        // Update UI
        updateUI();
        updateCharts();
        
        showToast('Trade deleted successfully', 'success');
    }
}

// Update Journal Table
function updateJournalTable() {
    const tableBody = document.getElementById('allTradesTable');
    tableBody.innerHTML = '';
    
    // Sort trades by date (newest first)
    const sortedTrades = [...currentTrades].sort((a, b) => {
        return new Date(b.date + ' ' + b.time) - new Date(a.date + ' ' + b.time);
    });
    
    sortedTrades.forEach(trade => {
        const row = createTradeTableRow(trade, true);
        tableBody.appendChild(row);
    });
}

// Export Journal PDF
async function exportJournalPDF() {
    if (currentTrades.length === 0) {
        showToast('No trades to export', 'warning');
        return;
    }
    
    try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        
        // Title
        pdf.setFont(undefined, 'bold');
        pdf.setFontSize(20);
        pdf.setTextColor(0, 82, 204);
        pdf.text('FX TAE TRADING JOURNAL', 105, 20, { align: 'center' });
        
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        pdf.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
        
        // Summary Stats
        pdf.setFontSize(14);
        pdf.text('SUMMARY STATISTICS', 20, 50);
        
        const totalTrades = currentTrades.length;
        const winningTrades = currentTrades.filter(t => parseFloat(t.pnl) > 0).length;
        const losingTrades = currentTrades.filter(t => parseFloat(t.pnl) < 0).length;
        const winRate = totalTrades > 0 ? ((winningTrades / totalTrades) * 100).toFixed(1) : 0;
        const totalProfit = currentTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0);
        
        pdf.setFontSize(12);
        let yPos = 60;
        const stats = [
            `Total Trades: ${totalTrades}`,
            `Winning Trades: ${winningTrades} (${winRate}%)`,
            `Losing Trades: ${losingTrades}`,
            `Total P&L: ${formatCurrency(totalProfit)}`,
            `Account Balance: ${formatCurrency(accountBalance)}`,
            `Starting Balance: ${formatCurrency(startingBalance)}`
        ];
        
        stats.forEach(stat => {
            pdf.text(stat, 30, yPos);
            yPos += 8;
        });
        
        yPos += 10;
        
        // Table Header
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        pdf.text('TRADE HISTORY', 20, yPos);
        yPos += 10;
        
        // Add page for table
        pdf.addPage();
        yPos = 20;
        
        // Table headers
        pdf.setFont(undefined, 'bold');
        pdf.setFontSize(10);
        const headers = ['Date', 'Time', '#', 'Pair', 'Strategy', 'P&L', 'Status', 'Notes'];
        const colWidths = [25, 20, 10, 25, 30, 25, 20, 35];
        let xPos = 20;
        
        headers.forEach((header, i) => {
            pdf.text(header, xPos, yPos);
            xPos += colWidths[i];
        });
        
        yPos += 8;
        pdf.setDrawColor(200, 200, 200);
        pdf.line(20, yPos - 2, 190, yPos - 2);
        
        // Table rows
        pdf.setFont(undefined, 'normal');
        const sortedTrades = [...currentTrades].sort((a, b) => new Date(a.date) - new Date(b.date));
        
        sortedTrades.forEach((trade, index) => {
            if (yPos > 270) {
                pdf.addPage();
                yPos = 20;
            }
            
            const pnl = parseFloat(trade.pnl);
            const isWin = pnl > 0;
            
            xPos = 20;
            const rowData = [
                trade.date,
                trade.time.substring(0, 5),
                trade.tradeNumber,
                trade.currencyPair,
                trade.strategy.substring(0, 12),
                `${pnl >= 0 ? '+' : ''}${pnl.toFixed(2)}`,
                isWin ? 'WIN' : 'LOSS',
                (trade.notes || '-').substring(0, 20)
            ];
            
            // Set color for P&L and Status
            pdf.setTextColor(isWin ? 0 : 255, isWin ? 128 : 0, isWin ? 0 : 0);
            rowData.forEach((data, i) => {
                if (i === 5 || i === 6) {
                    pdf.text(data, xPos, yPos);
                }
                xPos += colWidths[i];
            });
            
            // Reset color for other columns
            pdf.setTextColor(0, 0, 0);
            xPos = 20;
            rowData.forEach((data, i) => {
                if (i !== 5 && i !== 6) {
                    pdf.text(data, xPos, yPos);
                }
                xPos += colWidths[i];
            });
            
            yPos += 8;
        });
        
        // Performance Analysis
        pdf.addPage();
        yPos = 20;
        pdf.setFont(undefined, 'bold');
        pdf.setFontSize(14);
        pdf.setTextColor(0, 82, 204);
        pdf.text('PERFORMANCE ANALYSIS', 105, yPos, { align: 'center' });
        yPos += 20;
        
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        
        const analyses = [
            `Best Trade: ${formatCurrency(Math.max(...currentTrades.map(t => parseFloat(t.pnl))))}`,
            `Worst Trade: ${formatCurrency(Math.min(...currentTrades.map(t => parseFloat(t.pnl))))}`,
            `Average Win: ${formatCurrency(calculateAverageWin())}`,
            `Average Loss: ${formatCurrency(calculateAverageLoss())}`,
            `Profit Factor: ${calculateProfitFactor().toFixed(2)}`,
            `Risk/Reward Ratio: ${calculateRiskRewardRatio().toFixed(2)}`,
            `Win Rate: ${winRate}%`,
            `Total Growth: ${formatCurrency(accountBalance - startingBalance)}`
        ];
        
        analyses.forEach((analysis, i) => {
            pdf.text(analysis, 20, yPos);
            yPos += 10;
        });
        
        // Save PDF
        const fileName = `FX_TAE_Journal_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(fileName);
        
        showToast('Journal exported successfully', 'success');
    } catch (error) {
        console.error('Error exporting journal:', error);
        showToast('Error exporting journal', 'error');
    }
}

// Calculate Profit Factor
function calculateProfitFactor() {
    const winningTrades = currentTrades.filter(t => parseFloat(t.pnl) > 0);
    const losingTrades = currentTrades.filter(t => parseFloat(t.pnl) < 0);
    
    const grossProfit = winningTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0);
    const grossLoss = Math.abs(losingTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0));
    
    return grossLoss > 0 ? grossProfit / grossLoss : grossProfit > 0 ? 999 : 0;
}

// Calculate Risk/Reward Ratio
function calculateRiskRewardRatio() {
    const winningTrades = currentTrades.filter(t => parseFloat(t.pnl) > 0);
    const losingTrades = currentTrades.filter(t => parseFloat(t.pnl) < 0);
    
    const avgWin = winningTrades.length > 0 ? 
        winningTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / winningTrades.length : 0;
    const avgLoss = losingTrades.length > 0 ? 
        Math.abs(losingTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0)) / losingTrades.length : 0;
    
    return avgLoss > 0 ? avgWin / avgLoss : avgWin > 0 ? 999 : 0;
}

// Calculate Average Win
function calculateAverageWin() {
    const winningTrades = currentTrades.filter(t => parseFloat(t.pnl) > 0);
    return winningTrades.length > 0 ? 
        winningTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0) / winningTrades.length : 0;
}

// Calculate Average Loss
function calculateAverageLoss() {
    const losingTrades = currentTrades.filter(t => parseFloat(t.pnl) < 0);
    return losingTrades.length > 0 ? 
        Math.abs(losingTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0)) / losingTrades.length : 0;
}

// Update Analytics
function updateAnalytics() {
    if (currentTrades.length === 0) {
        // Reset analytics to zero
        document.getElementById('profitFactorValue').textContent = '0.0';
        document.getElementById('analyticsWinRate').textContent = '0%';
        document.getElementById('riskRewardRatio').textContent = '0.0';
        document.getElementById('totalTradesCount').textContent = '0';
        document.getElementById('avgWinLossRatio').textContent = '0.0';
        document.getElementById('totalProfitValue').textContent = '$0.00';
        document.getElementById('longShortRatio').textContent = '0:0';
        document.getElementById('winLossRatio').textContent = '0%';
        return;
    }
    
    // Calculate metrics
    const totalTrades = currentTrades.length;
    const winningTrades = currentTrades.filter(t => parseFloat(t.pnl) > 0).length;
    const losingTrades = currentTrades.filter(t => parseFloat(t.pnl) < 0).length;
    const winRate = ((winningTrades / totalTrades) * 100).toFixed(1);
    
    const profitFactor = calculateProfitFactor();
    const riskReward = calculateRiskRewardRatio();
    const avgWin = calculateAverageWin();
    const avgLoss = calculateAverageLoss();
    const totalProfit = currentTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0);
    
    // Update metric displays
    document.getElementById('profitFactorValue').textContent = profitFactor.toFixed(2);
    document.getElementById('analyticsWinRate').textContent = `${winRate}%`;
    document.getElementById('riskRewardRatio').textContent = riskReward.toFixed(2);
    document.getElementById('totalTradesCount').textContent = totalTrades;
    document.getElementById('avgWinLossRatio').textContent = (avgLoss !== 0 ? Math.abs(avgWin / avgLoss) : 0).toFixed(2);
    document.getElementById('totalProfitValue').textContent = formatCurrency(totalProfit);
    document.getElementById('longShortRatio').textContent = `${winningTrades}:${losingTrades}`;
    document.getElementById('winLossRatio').textContent = `${winRate}%`;
    
    // Update charts
    updateAnalyticsCharts();
}

// Update Calendar
function updateCalendar() {
    const now = new Date();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();
    
    // Update month display
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'];
    document.getElementById('calendarMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;
    
    // Get first day of month
    const firstDay = new Date(currentYear, currentMonth, 1);
    const lastDay = new Date(currentYear, currentMonth + 1, 0);
    
    // Create calendar grid
    const calendarGrid = document.getElementById('calendarGrid');
    calendarGrid.innerHTML = '';
    
    // Add day headers
    const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
    days.forEach(day => {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = day;
        calendarGrid.appendChild(dayElement);
    });
    
    // Add empty cells for days before first day
    for (let i = 0; i < firstDay.getDay(); i++) {
        const emptyCell = document.createElement('div');
        calendarGrid.appendChild(emptyCell);
    }
    
    // Add days of month
    for (let day = 1; day <= lastDay.getDate(); day++) {
        const dateElement = document.createElement('div');
        dateElement.className = 'calendar-date';
        dateElement.textContent = day;
        
        // Check if there are trades for this day
        const currentDate = new Date(currentYear, currentMonth, day);
        const dateString = currentDate.toDateString();
        
        const dayTrades = currentTrades.filter(trade => {
            const tradeDate = new Date(trade.date + ' ' + trade.time).toDateString();
            return tradeDate === dateString;
        });
        
        if (dayTrades.length > 0) {
            const dayProfit = dayTrades.reduce((sum, trade) => sum + parseFloat(trade.pnl), 0);
            if (dayProfit > 0) {
                dateElement.classList.add('profit');
                dateElement.title = `Profit: ${formatCurrency(dayProfit)}`;
            } else if (dayProfit < 0) {
                dateElement.classList.add('loss');
                dateElement.title = `Loss: ${formatCurrency(dayProfit)}`;
            }
        }
        
        calendarGrid.appendChild(dateElement);
    }
}

// Change Calendar Month
function changeCalendarMonth(direction) {
    // This would require storing current calendar month in a variable
    // For simplicity, we'll just update to current month
    updateCalendar();
}

// Export Analytics PDF
async function exportAnalyticsPDF() {
    try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        
        // Title
        pdf.setFont(undefined, 'bold');
        pdf.setFontSize(20);
        pdf.setTextColor(0, 82, 204);
        pdf.text('FX TAE TRADING ANALYTICS', 105, 20, { align: 'center' });
        
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        pdf.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 30, { align: 'center' });
        
        // Key Metrics
        pdf.setFontSize(16);
        pdf.text('KEY METRICS', 20, 50);
        
        pdf.setFontSize(12);
        const metrics = [
            `Profit Factor: ${calculateProfitFactor().toFixed(2)}`,
            `Win Rate: ${((currentTrades.filter(t => parseFloat(t.pnl) > 0).length / currentTrades.length) * 100 || 0).toFixed(1)}%`,
            `Risk/Reward Ratio: ${calculateRiskRewardRatio().toFixed(2)}`,
            `Total Trades: ${currentTrades.length}`,
            `Average Win: ${formatCurrency(calculateAverageWin())}`,
            `Average Loss: ${formatCurrency(calculateAverageLoss())}`,
            `Total Profit/Loss: ${formatCurrency(currentTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0))}`,
            `Account Balance: ${formatCurrency(accountBalance)}`
        ];
        
        let yPos = 60;
        metrics.forEach(metric => {
            pdf.text(metric, 30, yPos);
            yPos += 8;
        });
        
        // Add chart images if available
        if (currentTrades.length > 0) {
            yPos += 10;
            pdf.setFontSize(14);
            pdf.text('PERFORMANCE CHARTS', 20, yPos);
            
            // Note: In a real implementation, you would generate and embed chart images
            // This is a simplified version
        }
        
        // Save PDF
        const fileName = `FX_TAE_Analytics_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(fileName);
        
        showToast('Analytics exported successfully', 'success');
    } catch (error) {
        console.error('Error exporting analytics:', error);
        showToast('Error exporting analytics', 'error');
    }
}

// Dream Notebook Functions
function saveDream() {
    const dreamInput = document.getElementById('dreamInput');
    const dreamText = dreamInput.value.trim();
    
    if (!dreamText) {
        showToast('Please write your note first', 'warning');
        return;
    }
    
    const dream = {
        id: generateId(),
        date: new Date().toLocaleDateString(),
        time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}),
        content: dreamText,
        timestamp: new Date().getTime()
    };
    
    dreams.push(dream);
    saveData();
    updateDreamsList();
    
    dreamInput.value = '';
    showToast('Note saved successfully!', 'success');
}

function updateDreamsList() {
    const dreamsList = document.getElementById('dreamsList');
    dreamsList.innerHTML = '';
    
    if (dreams.length === 0) {
        dreamsList.innerHTML = '<div class="dream-item"><p>No notes recorded yet. Write your first trading note!</p></div>';
        return;
    }
    
    // Sort dreams by date (newest first)
    const sortedDreams = [...dreams].sort((a, b) => b.timestamp - a.timestamp);
    
    sortedDreams.forEach(dream => {
        const dreamElement = document.createElement('div');
        dreamElement.className = 'dream-item';
        dreamElement.innerHTML = `
            <div class="dream-date"><i class="far fa-clock"></i> ${dream.date}  ${dream.time}</div>
            <div class="dream-content">${dream.content}</div>
        `;
        dreamsList.appendChild(dreamElement);
    });
}

function clearDream() {
    if (confirm('Clear the note input?')) {
        document.getElementById('dreamInput').value = '';
    }
}

// Settings Functions
function loadSettingsToForm() {
    document.getElementById('dailyMaxLoss').value = settings.dailyMaxLoss || 2;
    document.getElementById('dailyTradeLimit').value = settings.dailyTradeLimit || 4;
    document.getElementById('riskPerTrade').value = settings.riskPerTrade || 1;
    document.getElementById('tradingHours').value = settings.tradingHours || '24/7';
    
    // Update theme buttons
    if (settings.theme === 'dark') {
        document.getElementById('darkThemeBtn').classList.add('active');
        document.getElementById('lightThemeBtn').classList.remove('active');
    } else {
        document.getElementById('lightThemeBtn').classList.add('active');
        document.getElementById('darkThemeBtn').classList.remove('active');
    }
}

function saveTradingRules() {
    settings.dailyMaxLoss = parseFloat(document.getElementById('dailyMaxLoss').value) || 2;
    settings.dailyTradeLimit = parseInt(document.getElementById('dailyTradeLimit').value) || 4;
    settings.riskPerTrade = parseFloat(document.getElementById('riskPerTrade').value) || 1;
    settings.tradingHours = document.getElementById('tradingHours').value || '24/7';
    
    saveData();
    showToast('Trading rules saved', 'success');
}

function setTheme(theme) {
    settings.theme = theme;
    
    const lightBtn = document.getElementById('lightThemeBtn');
    const darkBtn = document.getElementById('darkThemeBtn');
    
    lightBtn.classList.remove('active');
    darkBtn.classList.remove('active');
    
    if (theme === 'dark') {
        document.body.classList.add('dark-theme');
        darkBtn.classList.add('active');
    } else {
        document.body.classList.remove('dark-theme');
        lightBtn.classList.add('active');
    }
    
    saveData();
    showToast(`Theme set to ${theme} mode`, 'success');
}

async function exportAllData() {
    try {
        const format = document.getElementById('exportFormat').value;
        
        if (format === 'pdf') {
            await exportAllDataPDF();
        } else if (format === 'json') {
            exportAllDataJSON();
        } else if (format === 'csv') {
            exportAllDataCSV();
        }
    } catch (error) {
        console.error('Error exporting data:', error);
        showToast('Error exporting data', 'error');
    }
}

async function exportAllDataPDF() {
    try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        
        // Title
        pdf.setFont(undefined, 'bold');
        pdf.setFontSize(20);
        pdf.setTextColor(0, 82, 204);
        pdf.text('FX TAE COMPLETE DATA EXPORT', 105, 20, { align: 'center' });
        
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        pdf.text(`Exported on: ${new Date().toLocaleString()}`, 105, 30, { align: 'center' });
        
        // Trading Statistics
        let yPos = 50;
        pdf.setFontSize(16);
        pdf.text('TRADING STATISTICS', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(12);
        const stats = [
            `Total Trades: ${currentTrades.length}`,
            `Win Rate: ${currentTrades.length > 0 ? Math.round((currentTrades.filter(t => parseFloat(t.pnl) > 0).length / currentTrades.length) * 100) : 0}%`,
            `Profit Factor: ${calculateProfitFactor().toFixed(2)}`,
            `Total Profit/Loss: ${formatCurrency(currentTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0))}`,
            `Account Balance: ${formatCurrency(accountBalance)}`,
            `Starting Balance: ${formatCurrency(startingBalance)}`,
            `Total Growth: ${formatCurrency(accountBalance - startingBalance)}`
        ];
        
        stats.forEach(stat => {
            pdf.text(stat, 30, yPos);
            yPos += 8;
        });
        
        // Trading Rules
        yPos += 10;
        pdf.setFontSize(16);
        pdf.text('TRADING RULES', 20, yPos);
        yPos += 10;
        
        pdf.setFontSize(12);
        const rules = [
            `Daily Max Loss: ${settings.dailyMaxLoss}%`,
            `Daily Trade Limit: ${settings.dailyTradeLimit}`,
            `Risk Per Trade: ${settings.riskPerTrade}%`,
            `Trading Hours: ${settings.tradingHours}`
        ];
        
        rules.forEach(rule => {
            pdf.text(rule, 30, yPos);
            yPos += 8;
        });
        
        // Trade History (first page only, truncated)
        if (currentTrades.length > 0) {
            yPos += 10;
            pdf.addPage();
            yPos = 20;
            
            pdf.setFontSize(16);
            pdf.text('RECENT TRADES (Last 20)', 20, yPos);
            yPos += 10;
            
            pdf.setFontSize(10);
            const recentTrades = [...currentTrades].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 20);
            
            recentTrades.forEach((trade, index) => {
                if (yPos > 270) {
                    pdf.addPage();
                    yPos = 20;
                }
                
                const pnl = parseFloat(trade.pnl);
                pdf.setTextColor(0, 0, 0);
                pdf.text(`${trade.date} ${trade.time}`, 20, yPos);
                pdf.text(trade.currencyPair, 60, yPos);
                pdf.text(trade.strategy.substring(0, 15), 90, yPos);
                
                // Color code P&L
                pdf.setTextColor(pnl >= 0 ? 0 : 255, pnl >= 0 ? 128 : 0, pnl >= 0 ? 0 : 0);
                pdf.text(`${pnl >= 0 ? '+' : ''}${pnl.toFixed(2)}`, 130, yPos);
                
                pdf.setTextColor(0, 0, 0);
                const notes = trade.notes || '-';
                pdf.text(notes.substring(0, 30), 160, yPos);
                
                yPos += 10;
            });
        }
        
        // Save PDF
        const fileName = `FX_TAE_Export_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(fileName);
        
        showToast('All data exported successfully', 'success');
    } catch (error) {
        console.error('Error exporting PDF:', error);
        showToast('Error exporting PDF', 'error');
    }
}

function exportAllDataJSON() {
    try {
        const exportData = {
            exportDate: new Date().toISOString(),
            trades: currentTrades,
            dreams: dreams,
            settings: settings,
            statistics: {
                totalTrades: currentTrades.length,
                winRate: currentTrades.length > 0 ? Math.round((currentTrades.filter(t => parseFloat(t.pnl) > 0).length / currentTrades.length) * 100) : 0,
                profitFactor: calculateProfitFactor(),
                totalProfit: currentTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0),
                accountBalance: accountBalance,
                startingBalance: startingBalance
            }
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `FX_TAE_Data_${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        document.body.appendChild(linkElement);
        linkElement.click();
        document.body.removeChild(linkElement);
        
        showToast('All data exported as JSON', 'success');
    } catch (error) {
        console.error('Error exporting JSON:', error);
        showToast('Error exporting JSON', 'error');
    }
}

function exportAllDataCSV() {
    try {
        // Create CSV content
        let csvContent = "FX TAE Trading Data Export\n";
        csvContent += `Exported on:,${new Date().toLocaleString()}\n\n`;
        
        // Statistics
        csvContent += "STATISTICS\n";
        csvContent += `Total Trades,${currentTrades.length}\n`;
        csvContent += `Win Rate,${currentTrades.length > 0 ? Math.round((currentTrades.filter(t => parseFloat(t.pnl) > 0).length / currentTrades.length) * 100) : 0}%\n`;
        csvContent += `Profit Factor,${calculateProfitFactor().toFixed(2)}\n`;
        csvContent += `Total Profit/Loss,${currentTrades.reduce((sum, t) => sum + parseFloat(t.pnl), 0)}\n`;
        csvContent += `Account Balance,${accountBalance}\n`;
        csvContent += `Starting Balance,${startingBalance}\n\n`;
        
        // Trades
        if (currentTrades.length > 0) {
            csvContent += "TRADES\n";
            csvContent += "Date,Time,Trade #,Currency Pair,Strategy,P&L,Notes\n";
            currentTrades.forEach(trade => {
                csvContent += `${trade.date},${trade.time},${trade.tradeNumber},${trade.currencyPair},${trade.strategy},${trade.pnl},"${(trade.notes || '').replace(/"/g, '""')}"\n`;
            });
            csvContent += "\n";
        }
        
        // Dreams/Notes
        if (dreams.length > 0) {
            csvContent += "NOTES\n";
            csvContent += "Date,Time,Content\n";
            dreams.forEach(dream => {
                csvContent += `${dream.date},${dream.time},"${dream.content.replace(/"/g, '""')}"\n`;
            });
        }
        
        const dataUri = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csvContent);
        const exportFileDefaultName = `FX_TAE_Data_${new Date().toISOString().split('T')[0]}.csv`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        document.body.appendChild(linkElement);
        linkElement.click();
        document.body.removeChild(linkElement);
        
        showToast('All data exported as CSV', 'success');
    } catch (error) {
        console.error('Error exporting CSV:', error);
        showToast('Error exporting CSV', 'error');
    }
}

function backupData() {
    try {
        const backupData = {
            trades: currentTrades,
            dreams: dreams,
            settings: settings,
            balance: accountBalance,
            startingBalance: startingBalance,
            backupDate: new Date().toISOString()
        };
        
        const dataStr = JSON.stringify(backupData, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        
        const exportFileDefaultName = `FX_TAE_Backup_${new Date().toISOString().split('T')[0]}.json`;
        
        const linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        document.body.appendChild(linkElement);
        linkElement.click();
        document.body.removeChild(linkElement);
        
        showToast('Data backup created', 'success');
    } catch (error) {
        console.error('Error creating backup:', error);
        showToast('Error creating backup', 'error');
    }
}

function clearAllData() {
    if (confirm('WARNING: This will delete ALL your trading data, notes, and settings. This action cannot be undone. Are you sure?')) {
        if (confirm('Are you absolutely sure? This will reset everything to default.')) {
            // Clear all data
            currentTrades = [];
            dreams = [];
            accountBalance = 0;
            startingBalance = 0;
            settings = {
                dailyMaxLoss: 2,
                dailyTradeLimit: 4,
                riskPerTrade: 1,
                tradingHours: '24/7',
                theme: 'light'
            };
            
            // Clear localStorage
            localStorage.removeItem('fxTaeTrades');
            localStorage.removeItem('fxTaeDreams');
            localStorage.removeItem('fxTaeSettings');
            localStorage.removeItem('fxTaeBalance');
            localStorage.removeItem('fxTaeStartingBalance');
            
            // Reset UI
            updateUI();
            updateCharts();
            updateDreamsList();
            loadSettingsToForm();
            
            showToast('All data cleared successfully', 'info');
        }
    }
}

// Toast Notification System
function showToast(message, type = 'info') {
    const toastContainer = document.getElementById('toastContainer');
    
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    
    const icons = {
        success: 'fa-check-circle',
        error: 'fa-exclamation-circle',
        info: 'fa-info-circle',
        warning: 'fa-exclamation-triangle'
    };
    
    toast.innerHTML = `
        <div class="toast-icon">
            <i class="fas ${icons[type]}"></i>
        </div>
        <div class="toast-content">
            <h4>${type.charAt(0).toUpperCase() + type.slice(1)}</h4>
            <p>${message}</p>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    toastContainer.appendChild(toast);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 5000);
}

// Login Screen (placeholder)
function showLoginScreen() {
    // This would show a login screen in a real application
    // For now, just reload the dashboard
    setTimeout(() => {
        location.reload();
    }, 1000);
}

// Additional utility functions
function downloadTodayStats() {
    const today = new Date().toDateString();
    const todayTrades = currentTrades.filter(trade => {
        const tradeDate = new Date(trade.date + ' ' + trade.time).toDateString();
        return tradeDate === today;
    });
    
    if (todayTrades.length === 0) {
        showToast('No trades today to download', 'info');
        return;
    }
    
    const todayProfit = todayTrades.reduce((sum, trade) => sum + parseFloat(trade.pnl), 0);
    
    try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();
        
        // Set font to bold
        pdf.setFont(undefined, 'bold');
        pdf.setFontSize(20);
        pdf.setTextColor(0, 82, 204);
        pdf.text("TODAY'S TRADING SUMMARY", 105, 20, { align: 'center' });
        
        pdf.setFontSize(12);
        pdf.setTextColor(0, 0, 0);
        pdf.text(`Date: ${new Date().toLocaleDateString()}`, 20, 40);
        pdf.text(`Total Trades: ${todayTrades.length}`, 20, 50);
        pdf.text(`Total P&L: ${formatCurrency(todayProfit)}`, 20, 60);
        
        // Trade Details
        pdf.setFontSize(14);
        pdf.text('Trade Details:', 20, 80);
        
        pdf.setFontSize(10);
        let yPos = 90;
        todayTrades.forEach((trade, index) => {
            if (yPos > 270) {
                pdf.addPage();
                yPos = 20;
            }
            
            const pnl = parseFloat(trade.pnl);
            pdf.setTextColor(pnl >= 0 ? 0 : 255, pnl >= 0 ? 128 : 0, pnl >= 0 ? 0 : 0);
            pdf.text(`${trade.time} - ${trade.currencyPair} - ${trade.strategy} - ${pnl >= 0 ? '+' : ''}${pnl.toFixed(2)}`, 30, yPos);
            yPos += 8;
        });
        
        const fileName = `Today_Trades_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(fileName);
        
        showToast("Today's stats downloaded", 'success');
    } catch (error) {
        console.error('Error downloading today stats:', error);
        showToast('Error downloading stats', 'error');
    }
}

function closeEditBalanceModal() {
    document.getElementById('editBalanceModal').classList.remove('show');
    document.getElementById('editBalanceModal').style.display = 'none';
}

function confirmBalanceUpdate() {
    const newBalance = parseFloat(document.getElementById('newBalanceInput').value);
    if (!isNaN(newBalance) && newBalance >= 0) {
        accountBalance = newBalance;
        saveData();
        updateUI();
        updateCharts();
        closeEditBalanceModal();
        showToast('Account balance updated', 'success');
    } else {
        showToast('Please enter a valid positive number', 'error');
    }
}

// Prevent zoom
document.addEventListener('wheel', function(event) {
    if (event.ctrlKey) {
        event.preventDefault();
    }
}, { passive: false });

document.addEventListener('keydown', function(event) {
    if (event.ctrlKey && (event.key === '+' || event.key === '-' || event.key === '=')) {
        event.preventDefault();
    }
});
    </script>
</body>
</html>
